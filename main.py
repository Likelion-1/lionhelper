
import os
from fastapi import FastAPI, HTTPException, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from fastapi.responses import FileResponse, JSONResponse
from fastapi.exceptions import RequestValidationError
from pydantic import BaseModel, Field
from typing import Optional, List
import uvicorn
import logging
from difflib import SequenceMatcher
import requests
import json
import uuid
from datetime import datetime
import sqlite3
import os

# ë¡œê¹… ì„¤ì •
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# Ollama ì„¤ì •
OLLAMA_BASE_URL = os.getenv("OLLAMA_BASE_URL", "http://localhost:11434")
OLLAMA_MODEL = os.getenv("OLLAMA_MODEL", "gpt-oss:20b")  # í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì • ê°€ëŠ¥

# ì™¸ë¶€ Ollama ì„œë¹„ìŠ¤ URL (í•„ìš”ì‹œ ì‚¬ìš©)
EXTERNAL_OLLAMA_URL = os.getenv("EXTERNAL_OLLAMA_URL", "")

# ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
def init_database():
    """SQLite ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”"""
    conn = sqlite3.connect('chat_history.db')
    cursor = conn.cursor()
    
    # ì„¸ì…˜ í…Œì´ë¸”
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS sessions (
            id TEXT PRIMARY KEY,
            title TEXT NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        )
    ''')
    
    # ë©”ì‹œì§€ í…Œì´ë¸”
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS messages (
            id TEXT PRIMARY KEY,
            session_id TEXT NOT NULL,
            role TEXT NOT NULL,
            content TEXT NOT NULL,
            response_type TEXT,
            model_used TEXT,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            FOREIGN KEY (session_id) REFERENCES sessions (id)
        )
    ''')
    
    conn.commit()
    conn.close()

# ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤í–‰
init_database()

# QA ë°ì´í„°ë² ì´ìŠ¤ (í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ì‘ë‹µ)
QA_DATABASE = {
    "ì¤Œ": {
        "keywords": ["ì¤Œ", "zoom", "ë°°ê²½", "í™”ë©´", "ì„¤ì •"],
        "question": "ë°°ê²½ í™”ë©´ë„ ì„¤ì •í•´ì•¼ í•˜ë‚˜ìš”? ì–´ë–»ê²Œ í•˜ë‚˜ìš”?",
        "answer": "í•´ë‹¹ ì‚¬í•­ì€ ìˆ˜ê°•ìƒ ê³µì‹ ì•ˆë‚´ í˜ì´ì§€(ë…¸ì…˜) ë‚´ K-Digital Training ìˆ˜ê°•ì¤€ë¹„ ê°€ì´ë“œì— ìì„¸íˆ ë‚˜ì™€ìˆìŒì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤. í™•ì¸í•˜ì‹œê³  ëª¨ë‘ ì„¤ì • ë¶€íƒë“œë¦½ë‹ˆë‹¤."
    },
    "í›ˆë ¨ì¥ë ¤ê¸ˆ": {
        "keywords": ["í›ˆë ¨ì¥ë ¤ê¸ˆ", "ìˆ˜ë ¹", "ê³„ì¢Œ", "ì •ë³´", "ì•ˆë³´ì„"],
        "question": "í›ˆë ¨ì¥ë ¤ê¸ˆ ìˆ˜ë ¹ ê³„ì¢Œ ì •ë³´ê°€ ì•ˆë³´ì´ë©´ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?",
        "answer": "ê°œê°•ì „ì´ë¼ë©´, ê³ ìš© 24 ë¡œê·¸ì¸ â†’ ì˜¨ë¼ì¸ ìˆ˜ê°•ì‹ ì²­ â†’ ìˆ˜ê°•ì‹ ì²­ ìƒì„¸ë³´ê¸° í´ë¦­\nê°œê°• ì´í›„ë¼ë©´, ë¶€íŠ¸ìº í”„ë³„ë¡œ ì•ˆë‚´ëœ 'êµ¬ê¸€í¼ ë§í¬(í›ˆë ¨ì¥ë ¤ê¸ˆ ë³€ê²½ êµ¬ê¸€í¼ ì‹ ì²­ë§í¬)'ë¥¼ í†µí•´ ë³€ê²½ ì •ë³´ ì œì¶œ"
    },
    "ì¶œê²°_ì™¸ì¶œ": {
        "keywords": ["ì¶œê²°", "ì™¸ì¶œ", "êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„", "ê³ ìš©ë³µì§€ì„¼í„°", "ìƒë‹´", "ê³µì ", "ê²°ì„"],
        "question": "êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„ ê´€ë ¨ìœ¼ë¡œ ê³ ìš©ë³µì§€ì„¼í„°ì™€ ìƒë‹´ì´ í•„ìš”í•œë° ì´ ê²½ìš° ì™¸ì¶œë¡œ ë‹¤ë…€ì˜¤ë©´ ë˜ë‚˜ìš”? ì•„ë‹ˆë©´ ê³µì ì¸ ê²°ì„ìœ¼ë¡œ ì¸ì •í•´ì£¼ë‚˜ìš”?",
        "answer": "í•´ë‹¹ ì‚¬ìœ ë¡œ ê³µì ì¸ ê²°ì„ì€ ì–´ë ¤ìš°ë©°, 'ì™¸ì¶œ' ë˜ëŠ” 'ì¡°í‡´' QRì²˜ë¦¬ í•„ìš”"
    },
    "í™”ì¥ì‹¤": {
        "keywords": ["í™”ì¥ì‹¤", "ììœ ë¡­ê²Œ", "ì¥ì‹œê°„", "ìë¦¬", "ë¹„ì›€"],
        "question": "ìˆ˜ì—… ì¤‘ì— í™”ì¥ì‹¤ì€ ììœ ë¡­ê²Œ ë‹¤ë…€ì™€ë„ ë˜ë‚˜ìš”?",
        "answer": "ë‹¤ë§Œ ì¥ì‹œê°„ ìë¦¬ë¥¼ ë¹„ìš°ì‹œëŠ” ê²½ìš°ì—ëŠ” ë¶€íŠ¸ìº í”„ ë‹´ë‹¹ìë‹˜ì˜ DMì´ ê°ˆ ìˆ˜ ìˆìŒì„ ì¸ì§€í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤."
    },
    "ê¸°ì´ˆí´ë˜ìŠ¤_ì¶œê²°": {
        "keywords": ["ê¸°ì´ˆí´ë˜ìŠ¤", "ì˜¨ë¼ì¸", "ì¶œê²°", "ë“±ë¡", "í›ˆë ¨ìƒ", "ë“±ë¡ë˜ì§€ ì•ŠëŠ”"],
        "question": "ê¸°ì´ˆí´ë˜ìŠ¤ ì˜¨ë¼ì¸ ì¶œê²° ë“±ë¡ ì‹œ, ë“±ë¡ë˜ì§€ ì•ŠëŠ” í›ˆë ¨ìƒìœ¼ë¡œ ë– ì„œ ì˜¨ë¼ì¸ ì¶œê²° ë“±ë¡ì´ ë¶ˆê°€í•©ë‹ˆë‹¤. ì–´ë–»ê²Œ ìˆ˜ì •í•˜ë©´ ë ê¹Œìš”?",
        "answer": "- ë¨¼ì € ìƒë…„ì›”ì¼ì„±ë³„ì´ ex) 97010102 í˜•íƒœë¡œ ì…ë ¥ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\n- í›ˆë ¨ìƒì„±ëª…, í›ˆë ¨ì¼ì, ê³¼ì •ì½”ë“œ, í›ˆë ¨ê³¼ì •íšŒì°¨ì— ë¬¸ì œê°€ ì—†ëŠ”ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.\n- ì „ë¶€ ì´ìƒì´ ì—†ëŠ”ë°ë„ ì¶œê²° ë“±ë¡ì´ ë¶ˆê°€í•  ê²½ìš° ì „ì‚°ë¬¸ì œë¡œ PAíŒ€ìœ¼ë¡œ ë¬¸ì˜í•´ ì£¼ì„¸ìš”!"
    },
    "ë‚´ì¼ë°°ì›€ì¹´ë“œ": {
        "keywords": ["ë‚´ì¼ë°°ì›€ì¹´ë“œ", "ì´ìŠˆ", "ìˆ˜ê°•ìƒ", "ë“±ë¡", "ëŠ¦ê²Œ", "ì •ìƒ", "ì¶œê²°"],
        "question": "ìµœê·¼ì— ê°œê°•ì„ í•´ì„œ, ë‚´ì¼ë°°ì›€ì¹´ë“œ ì´ìŠˆë¡œ ì¸í•´ ê¸ˆì¼ 9ì‹œ ë„˜ì–´ì„œ ìˆ˜ê°•ìƒ ë“±ë¡ì´ ëœ ê²½ìš° ê¸ˆì¼ì ì¶œê²°ì„ ì •ìƒ ì¶œê²°ë¡œ ë³€ê²½ì´ ê°€ëŠ¥í•œ ë¶€ë¶„ì¼ê¹Œìš”?",
        "answer": "ë‚´ì¼ë°°ì›€ì¹´ë“œ ë°œê¸‰ì´ ëŠ¦ì–´ì ¸ì„œ ë“±ë¡ì´ ëŠ¦ê²Œ ëœ ê²½ìš° ì •ìƒ ì¶œê²° ì •ì •ì€ ì–´ë ¤ìš°ë©°, ëŠ¦ê²Œë¼ë„ QR ì…ì‹¤ ì²´í¬ë¥¼ í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤."
    },
    "ì‚¬ë‘ë‹ˆ": {
        "keywords": ["ì‚¬ë‘ë‹ˆ", "ë°œì¹˜", "ê³µê²°", "ì¹˜ê³¼", "ì§„ë£Œ"],
        "question": "ì‚¬ë‘ë‹ˆ ë°œì¹˜ë„ ê³µê²° ì¸ì •ì´ ë ê¹Œìš”?",
        "answer": "ì¹˜ê³¼ì§„ë£Œ í•­ëª©(ìŠ¤ì¼€ì¼ë§, ì‚¬ë‘ë‹ˆ ë°œì¹˜, ì¹˜ì•„ ë°œì¹˜, êµì • ë“±)ì€ ê³µê²° ì‹ ì²­ì´ ë¶ˆê°€í•©ë‹ˆë‹¤."
    },
    "ì…ì›": {
        "keywords": ["ì…ì›", "ê²©ë¦¬", "ì§„ë‹¨ì„œ", "ë§¤ì¼", "ì œì¶œ"],
        "question": "ë³‘ì›ì—ì„œ ë‹¹ë¶„ê°„ ì…ì› í˜¹ì€ ê²©ë¦¬ì¡°ì¹˜ë¥¼ ë°›ì•˜ëŠ”ë°, ê³µê²° ì‹ ì²­ì„ ìœ„í•œ ì§„ë‹¨ì„œë¥¼ ë§¤ì¼ ë°›ì•„ì„œ ì œì¶œí•´ì•¼ ë˜ë‚˜ìš”?",
        "answer": "- ì…ì›ìœ¼ë¡œ ì¸í•œ ê³µê²°ì‹ ì²­ ì‹œ, ì…í‡´ì›í™•ì¸ì„œë¥¼ ì œì¶œí•´ ì£¼ì‹œë©´ ë©ë‹ˆë‹¤."
    },
    "ìˆ˜ë£Œ_ì¶œì„ë¥ ": {
        "keywords": ["ìˆ˜ë£Œ", "ì¶œì„", "ëª‡ì¼", "ê°€ëŠ¥"],
        "question": "ëª‡ ì¼ ì´ìƒ ì¶œì„í•´ì•¼ ìˆ˜ë£Œê°€ ê°€ëŠ¥í• ê¹Œìš”?",
        "answer": "- ì „ì²´ í›ˆë ¨ì¼ìˆ˜ì—ì„œ 80%ì´ìƒ ì¶œì„ì„ í•˜ì…”ì•¼ ìˆ˜ë£Œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    },
    "ë‹¨ìœ„ê¸°ê°„_ê²°ì„": {
        "keywords": ["ë‹¨ìœ„ê¸°ê°„", "ê²°ì„", "ëª‡ë²ˆ", "í›ˆë ¨ì¥ë ¤ê¸ˆ"],
        "question": "ë‹¨ìœ„ê¸°ê°„ì— ê²°ì„ì€ ëª‡ ë²ˆ í•  ìˆ˜ ìˆë‚˜ìš”?",
        "answer": "- ë‹¨ìœ„ê¸°ê°„ ì¼ìˆ˜ì—ì„œ 80% ì´ìƒ ì¶œì„í•˜ì…”ì•¼ í›ˆë ¨ì¥ë ¤ê¸ˆ ìˆ˜ë ¹ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n- ì˜ˆë¥¼ ë“¤ì–´ ë‹¨ìœ„ê¸°ê°„ ìˆ˜ì—… ì¼ìˆ˜ê°€ 18ì¼ì´ë©´ => 18 * 80% => 14.4(ì˜¬ë¦¼) => 15ì´ìƒ ì¶œì„í•´ ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤."
    },
    "ìˆ˜ë£Œí›„_ì·¨ì—…": {
        "keywords": ["ìˆ˜ë£Œì¼ìˆ˜", "ì·¨ì—…", "ì²˜ë¦¬", "ì„œë¥˜"],
        "question": "ìˆ˜ë£Œì¼ìˆ˜ë¥¼ ë‹¤ ì±„ìš°ê³  ì·¨ì—…ì„ í•˜ê²Œ ë  ê²½ìš° ì–´ë–»ê²Œ ì²˜ë¦¬ê°€ ë˜ëŠ” ê±¸ê¹Œìš”?, í•„ìš”í•œ ì„œë¥˜ê°€ ìˆì„ê¹Œìš”?",
        "answer": "- 80% ì´ìƒ ìˆ˜ì—… ìˆ˜ê°• í›„ ì·¨ì—…ì´ ë˜ì‹¤ ê²½ìš° ìˆ˜ë£Œ í›„ ì·¨ì—…ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©°, ê·¼ë¡œê³„ì•½ì„œì™€ ì¤‘ë„í¬ê¸° ì„œì•½ì„œë¥¼ ì œì¶œí•´ ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤."
    },
    "ë…¸íŠ¸ë¶_ë°˜ë‚©": {
        "keywords": ["ë…¸íŠ¸ë¶", "ë°˜ë‚©", "ì ˆì°¨", "í¬ì¥", "í”½ì—…"],
        "question": "ë…¸íŠ¸ë¶ ë°˜ë‚© ì ˆì°¨ëŠ” ì–´ë–»ê²Œ ì§„í–‰ë ê¹Œìš”?",
        "answer": "(í•œêµ­ë Œíƒˆì—ì„œ ì§„í–‰í•˜ëŠ” ê²½ìš°, ì•„ë˜ì™€ ê°™ì€ í”„ë¡œì„¸ìŠ¤ë¡œ ì§„í–‰)\n[ë…¸íŠ¸ë¶ ë°˜ë‚© ì¤€ë¹„ í”„ë¡œì„¸ìŠ¤]\n- ìš´ì˜ì§„ì—ê²Œ ë°˜ë‚© ê°€ëŠ¥ ì¼ì • / ì§‘ ì£¼ì†Œ / ì—°ë½ì²˜ ê³µìœ \n- ë°˜ë‚© ì¼ìì— ë§ì¶° í”½ì—… ë°›ì•˜ë˜ í¬ì¥ ê·¸ëŒ€ë¡œ í¬ì¥ ì§„í–‰ (í¬ì¥ì§€ ì—†ì„ ê²½ìš° ìš´ì˜ì§„ì—ê²Œ ì—°ë½) â†’ í¬ì¥ ëˆ„ë½ìœ¼ë¡œ ì¸í•´ ë…¸íŠ¸ë¶ íŒŒì†ì´ ë  ê²½ìš° ë³¸ì¸ì—ê²Œ ë¹„ìš© ì²­êµ¬ë¨\n- í¬ì¥ í›„ ë°˜ë‚© ì¼ìì— ë§ì¶° ë…¸íŠ¸ë¶ íšŒìˆ˜ ì¤€ë¹„\n- ë°°ì†¡ê¸°ì‚¬ë‹˜ì´ ì¼ìì— ë§ì¶° ë…¸íŠ¸ë¶ íšŒìˆ˜\n\n[ìš´ì˜ì§„ì—ê²Œ ì „ë‹¬í•  ì‚¬í•­ - 00ì›”00ì¼ê¹Œì§€ ê³µìœ í•´ ì£¼ì„¸ìš”]\n- ë°˜ë‚© ê°€ëŠ¥í•œ ì£¼ì†Œ ë° ì—°ë½ì²˜\n- í¬ì¥ì§€ í•„ìš” ì—¬ë¶€ (í¬ì¥ì§€ ë¶„ì‹¤ë¡œ ì¸í•´ í•„ìš”í•  ê²½ìš°, ë°°ì†¡ê¸°ì‚¬ë‹˜ì´ í¬ì¥ì§€ë¥¼ ë¨¼ì € ë°°ì†¡ í›„ í”½ì—…í•˜ì‹¤ ì˜ˆì •)\n- ë°°ì†¡ì¼ì í™•ì¸ : 00ì›” 00ì¼"
    },
    "ì™¸ì¶œ_ì¡°í‡´_ì§€ê°": {
        "keywords": ["ì™¸ì¶œ", "ì¡°í‡´", "ì§€ê°", "ê²°ì„", "ì²˜ë¦¬", "3ë²ˆ"],
        "question": "ì™¸ì¶œì´ë‚˜ ì¡°í‡´ ì§€ê° 3ë²ˆì´ ê²°ì„ 1ë²ˆìœ¼ë¡œ ì²˜ë¦¬ ë˜ë‚˜ìš”? ì™¸ì¶œ ì‹œê°„ì€ ìƒê´€ ì—†ë‚˜ìš”?",
        "answer": "- ì§€ê° + ì¡°í‡´ + ì™¸ì¶œ = 3íšŒ â†’ ê²°ì„ 1íšŒì™€ ê°™ìŠµë‹ˆë‹¤.\n- ì§€ê°,ì¡°í‡´,ì™¸ì¶œì˜ ê²½ìš° 1ì¼ í›ˆë ¨ ì‹œê°„ì˜ 50% ì´ˆê³¼ ì‹œ ê²°ì„ ì²˜ë¦¬ ë©ë‹ˆë‹¤."
    },
    "ì´ì‚¬_ê³µê²°": {
        "keywords": ["ì´ì‚¬", "ê³µê²°", "ì²˜ë¦¬", "ì¸ì •"],
        "question": "ì´ì‚¬ì˜ ê²½ìš° ê³µê²° ì²˜ë¦¬ ê°€ëŠ¥í•œê°€ìš”?",
        "answer": "ì¶œì„ ì¸ì • ê°€ëŠ¥í•œ ê³µê²°ì˜ ê²½ìš°ëŠ” ì²¨ë¶€í•œ ì‚¬ì§„ê³¼ ê°™ì€ ìƒí™©ì—ë§Œ ê³µê²° ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤!(ê³µê²°ì¸ì •ì‚¬ìœ  í‘œ ì²¨ë¶€)\nì´ì‚¬ì˜ ê²½ìš°ì—ëŠ” ê³µê²°ì¸ì •ì‚¬ìœ ì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ìˆ˜ì—…ì— ì°¸ì—¬í•˜ì§€ ëª»í•˜ì‹œê²Œ ë  ê²½ìš° ê²°ì„/ì¡°í‡´ ë“±ìœ¼ë¡œ ì²˜ë¦¬ ë©ë‹ˆë‹¤."
    },
    "ì…ì‹¤QR_ìŠ¤í¬ë¦°ìƒ·": {
        "keywords": ["ì…ì‹¤QR", "ìŠ¤í¬ë¦°ìƒ·", "ì»´í“¨í„°", "ë©ˆì¶¤", "ìº "],
        "question": "9ì‹œì— ì…ì‹¤QRì€ ì°ì—ˆìœ¼ë‚˜, ìŠ¤í¬ë¦°ìƒ· ì°ì„ ë•Œ ì»´í“¨í„°ê°€ ë©ˆì¶°ì„œ ìº ì„ ëª»ì¼°ì–´ìš”.",
        "answer": "í•­ìƒ HRD QRì´ ê°€ì¥ ìš°ì„ ì‹œ ë˜ë©°, QRí™•ì¸ ì˜¤ë¥˜ê°€ ìˆê±°ë‚˜ ì „ì‚°ìƒìœ¼ë¡œ ì…/í‡´ì‹¤ì— ëŒ€í•œ ì¦ë¹™ì´ í•„ìš”í•œ ê²½ìš° ì¤Œ ìŠ¤í¬ë¦°ìƒ·ì´ ê°€ì¥ ì¤‘ìš”í•œ ì¦ë¹™ìë£Œë¡œ ì“°ì´ê³  ìˆê¸°ì— ìŠ¤í¬ë¦°ìƒ·ë„ ì˜ ì°ì–´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.\nì˜¤ëŠ˜ ê±´ì€ ì…ì‹¤ QRì€ ì˜ ì°ì–´ì£¼ì…”ì„œ í•´ë‹¹ ë‚´ìš© ë‚¨ê²¨ë†“ê² ìœ¼ë‚˜, ì´í›„ë¡œëŠ” ëˆ„ë½ë˜ì§€ ì•Šë„ë¡ ì¹´ë©”ë¼ ë¯¸ë¦¬ í™•ì¸ í•´ì£¼ì‹œì–´ ìŠ¤í¬ë¦°ìƒ· ì˜ ì°ì–´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤."
    },
    "OT_ì¶œê²°": {
        "keywords": ["OT", "ì°¸ì—¬", "ì–´ë ¤ìš´", "ì¶œê²°", "ë°˜ì˜", "ë‚´ìš©"],
        "question": "ì²«ë‚  OT ì°¸ì—¬ê°€ ì–´ë ¤ìš´ë°, OT ë‚  ì¶œê²°ë„ ë™ì¼í•˜ê²Œ ì¶œì„ ë°˜ì˜ì´ ë˜ë‚˜ìš”? OT ê´€ë ¨ ë‚´ìš©ì„ ì¶”ê°€ë¡œ ë”°ë¡œ ì•ˆë‚´ ë°›ì„ ìˆ˜ ìˆì„ê¹Œìš”?",
        "answer": "OT ë˜í•œ ìˆ˜ê°•ê¸°ê°„ì— í¬í•¨ ë˜ê¸° ë•Œë¬¸ì— ê²°ì„ ì‹œ, ì¶œê²°ì— ë™ì¼í•˜ê²Œ ë°˜ì˜ë©ë‹ˆë‹¤.\nOTì— ì°¸ì—¬í•˜ì§€ ëª»í•˜ì‹  ë¶„ë“¤ì€ ë”°ë¡œ ì¶”ê°€ OT ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤."
    },
    "ë§¥ë¶_ê³ ì¥": {
        "keywords": ["ë§¥ë¶", "ê³ ì¥", "ìˆ˜ë¦¬", "ì¼ì£¼ì¼", "ìˆ˜ì—…"],
        "question": "ê°–ê³ ìˆëŠ” ë§¥ë¶ì´ ê³ ì¥ë‚¬ì–´ìš”. ìˆ˜ë¦¬ ê¸°ê°„ì´ ì¼ì£¼ì¼ì •ë„ ì†Œìš”ëœë‹¤ê³  í•˜ëŠ”ë°, ê·¸ë™ì•ˆ ìˆ˜ì—…ì„ ì–´ë–»ê²Œ ë“¤ì–´ì•¼ í• ê¹Œìš”?",
        "answer": "- ê±°ì£¼í•˜ì‹œëŠ” ì§€ì—­ì´ ì–´ë””ì‹ ê°€ìš”?\n- ë‹¹ì‚¬ ë°©ë¬¸í•˜ì‹œì–´ ë§¥ë¶ ëŒ€ì—¬ë¥¼ í•´ë“œë¦´ ìˆ˜ ìˆëŠ” ìƒí™©ì…ë‹ˆë‹¤. ë‹¨ê¸°ì„ëŒ€(ìµœì†Œ 1ê°œì›”)ë¡œë„ ëŒ€ì—¬ì§„í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    },
    "ê¸°ì´ˆí´ë˜ìŠ¤_ê²°ì„": {
        "keywords": ["ê¸°ì´ˆí´ë˜ìŠ¤", "ìˆ˜ê°•", "ì™„ë£Œ", "HRD", "ê²°ì„"],
        "question": "ê¸°ì´ˆí´ë˜ìŠ¤ ìˆ˜ê°•ì„ ì™„ë£Œí–ˆëŠ”ë°, HRDì—ì„œ ê²°ì„ìœ¼ë¡œ ëœ¹ë‹ˆë‹¤.",
        "answer": "ê¸°ì´ˆí´ë˜ìŠ¤ì˜ ê²½ìš° ì¶œê²°ì„ ìˆ˜ê¸°ë¡œ ë“±ë¡í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ì¶œê²° ë°˜ì˜ê¹Œì§€ ìµœëŒ€ 2ì£¼ì •ë„ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    },
    "ë‹¨ìœ„ê¸°ê°„_ì§€ê°": {
        "keywords": ["ë‹¨ìœ„ê¸°ê°„", "ì§€ê°", "ì ìš©", "ì¹´ìš´íŠ¸"],
        "question": "A ë‹¨ìœ„ê¸°ê°„ ë•Œ ì§€ê° 2ê°œ ìˆë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ B ë‹¨ìœ„ê¸°ê°„ ë•Œ ì§€ê° 1ê°œ ì°ìœ¼ë©´ B ë‹¨ìœ„ê¸°ê°„ë•Œ ê²°ì„ ì°íˆëŠ”ê±¸ê¹Œìš”?",
        "answer": "ì„¸ ë²ˆì§¸ ì¹´ìš´íŠ¸ ë˜ëŠ” ì‹œì ì˜ ë‹¨ìœ„ê¸°ê°„ì— ì ìš©ë©ë‹ˆë‹¤. (ì˜ˆì‹œì˜ ê²½ìš°, B ë‹¨ìœ„ê¸°ê°„)"
    },
    "í›ˆë ¨ì¥ë ¤ê¸ˆ_ì…ê¸ˆ": {
        "keywords": ["í›ˆë ¨ì¥ë ¤ê¸ˆ", "ì§€ë‚œ", "ë‹¨ìœ„ê¸°ê°„", "ì–¸ì œ", "ì…ê¸ˆ"],
        "question": "ì§€ë‚œ ë‹¨ìœ„ê¸°ê°„ í›ˆë ¨ì¥ë ¤ê¸ˆì€ ì–¸ì œ ì…ê¸ˆë˜ë‚˜ìš”?",
        "answer": "í›ˆë ¨ì¥ë ¤ê¸ˆ ì‹ ì²­ì€ ë³¸ ê³¼ì •ì˜ ëª¨ë“  í›ˆë ¨ìƒì˜ ì¶œê²° ì •ì • ë° ê·¼ë¡œ í˜•íƒœê°€ í™•ì¸ëœ ì´í›„ ì§„í–‰ë˜ê¸° ë•Œë¬¸ì— ì§€ê¸‰ê¹Œì§€ ìµœëŒ€ í•œ ë‹¬ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    },
    "ì¡°ê¸°ì·¨ì—…": {
        "keywords": ["ì¡°ê¸°ì·¨ì—…", "ì¤‘ë„í¬ê¸°", "ë¶ˆì´ìµ", "ë‚´ì¼ë°°ì›€ì¹´ë“œ"],
        "question": "ê³¼ì • ìˆ˜ê°• ì¤‘ì— ì·¨ì—…í•˜ê²Œ ë˜ë©´ ì–´ë–¤ ë¶ˆì´ìµì´ ìˆë‚˜ìš”?",
        "answer": "ì¡°ê¸°ì·¨ì—…ìœ¼ë¡œ ì¸í•œ ì¤‘ë„í¬ê¸° ì²˜ë¦¬ë˜ë©°, ë‚´ì¼ë°°ì›€ì¹´ë“œ ì”ì•¡ ì°¨ê° ë° 5ë…„ ì´ë‚´ KDT ê³¼ì • ìˆ˜ê°•ì´ ë¶ˆê°€í•©ë‹ˆë‹¤."
    },
    "ê³µê²°_íšŸìˆ˜": {
        "keywords": ["ê³µê²°", "ëª‡ë²ˆ", "ì‚¬ìš©", "ì§ˆë³‘", "íšŸìˆ˜"],
        "question": "ê³µê²° ëª‡ ë²ˆê¹Œì§€ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?",
        "answer": "ì§ˆë³‘ ê³µê²°ì—ë§Œ íšŸìˆ˜ê°€ ì œí•œë˜ì–´ ìˆê³ , ì „ì²´ í›ˆë ¨ì¼ìˆ˜ì˜ 10%ê¹Œì§€ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤."
    },
    "ê³„ì¢Œ_ë³€ê²½": {
        "keywords": ["í›ˆë ¨ì¥ë ¤ê¸ˆ", "ê³„ì¢Œ", "ë³€ê²½", "ì€í–‰", "ë²ˆí˜¸"],
        "question": "í›ˆë ¨ì¥ë ¤ê¸ˆ ìˆ˜ë ¹ ê³„ì¢Œë¥¼ ë³€ê²½í•˜ê³  ì‹¶ì€ë° ì–´ë–»ê²Œ ë³€ê²½í•˜ë‚˜ìš”?",
        "answer": "í–‰ì • ì±„ë„ì— ë³€ê²½í•˜ê³ ì í•˜ëŠ” ì€í–‰ê³¼ ê³„ì¢Œ ë²ˆí˜¸ë¥¼ í–‰ì • ë‹´ë‹¹ìë‹˜ê»˜ ì œì¶œ ë¶€íƒë“œë¦½ë‹ˆë‹¤."
    },
    "ê³µê²°_ì¶œì„ë¥ ": {
        "keywords": ["ì˜ˆë¹„êµ°", "ë³‘ì›", "ê³µê²°", "ì¶œì„ë¥ ", "í¬í•¨"],
        "question": "ì˜ˆë¹„êµ°, ë³‘ì› ë°©ë¬¸ ë“±ìœ¼ë¡œ ì¸í•œ ê³µê²°ì€ ì¶œì„ë¥ ì— í¬í•¨ë˜ëŠ” ê±´ê°€ìš”?",
        "answer": "ë„¤. ê³µê²°ì€ ì •ìƒì¶œì„ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì— ì¶œì„ë¥ ì— ë°˜ì˜ë©ë‹ˆë‹¤."
    },
    "HRD_ë¡œê·¸ì¸": {
        "keywords": ["HRD", "ì•±", "ì¶œì„", "ì˜¤ë¥˜", "ë¡œê·¸ì¸"],
        "question": "HRD ì•±ìœ¼ë¡œ ì¶œì„ ì§„í–‰í•˜ë ¤ê³  í•˜ëŠ”ë°, ê³„ì† ì˜¤ë¥˜ê°€ ë°œìƒí•´ì„œ ë¡œê·¸ì¸ì´ ë¶ˆê°€í•©ë‹ˆë‹¤. ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œìš”?",
        "answer": "ì¸ì¦ìˆ˜ë‹¨ì´ ì•„ë‹Œ ì•„ì´ë””ë¡œ ë¡œê·¸ì¸ ì‹œë„, ì–´í”Œ ì¬ì„¤ì¹˜ í›„ ë¡œê·¸ì¸ ì‹œë„ ë¶€íƒë“œë¦½ë‹ˆë‹¤."
    },
    "í•´ì™¸ì¶œêµ­": {
        "keywords": ["í•´ì™¸ì¶œêµ­", "í•´ì™¸ì—¬í–‰", "êµìœ¡", "ë¶ˆê°€", "ê²°ì„"],
        "question": "êµìœ¡ ì°¸ì—¬ ì¤‘ í•´ì™¸ ì¶œêµ­ì´ ë¶ˆê°€í•˜ë‹¤ê³  ì•ˆë‚´ ë°›ì•˜ëŠ”ë°, êµìœ¡ ë“£ëŠ” ê³¼ì • ì¤‘ì— í•´ì™¸ì—¬í–‰ë„ ë¶ˆê°€í•œê°€ìš”?",
        "answer": "ê²°ì„ ì²˜ë¦¬í•˜ì‹œê±°ë‚˜ íœ´ê°• ë° ì£¼ë§ í™œìš©í•˜ì—¬ í•´ì™¸ì—¬í–‰ ë‹¤ë…€ì˜¤ì‹œëŠ” ê±´ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    },
    "ì…ì‹¤QR_ëˆ„ë½": {
        "keywords": ["ì…ì‹¤QR", "ê¹œë¹¡", "ëˆ„ë½", "ì¶œê²°ì •ì •", "ê°œì¸ê³¼ì‹¤"],
        "question": "ì˜¤ëŠ˜ ì…ì‹¤QR ì°ëŠ” ê±¸ ìŠì–´ì„œ ì •ìƒ ì¶œì„ ì²˜ë¦¬ê°€ ì•ˆ ë  ê²ƒ ê°™ì€ë° ì…í‡´ì‹¤ ìŠ¤í¬ë¦°ìƒ·ì— ë¬¸ì œê°€ ì—†ë‹¤ë©´ ì¶œì„ìœ¼ë¡œ ì¶œê²°ì •ì • ê°€ëŠ¥í• ê¹Œìš”?!",
        "answer": "ê°œì¸ ê³¼ì‹¤ë¡œ ì¸í•´ ë°œìƒí•œ ì…ì‹¤ QR ëˆ„ë½ì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ê±´ì€ ì¶œê²°ì •ì • ë¶ˆê°€í•©ë‹ˆë‹¤.\nì•ìœ¼ë¡œëŠ” ì•ŒëŒì„ ë§ì¶°ë‘ì‹œëŠ” ë“± ëˆ„ë½ ì—†ë„ë¡ QRì²´í¬ ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤! : )"
    },
    "êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„_ì¥ë ¤ê¸ˆ": {
        "keywords": ["êµ­ë¯¼ì·¨ì—…ì§€ì›ì œë„", "êµ­ì·¨ì œ", "í›ˆë ¨ì¥ë ¤ê¸ˆ", "ë™ì‹œ", "ë°›ê¸°"],
        "question": "êµ­ë¯¼ì·¨ì—…ì œë„ì¥ë ¤ê¸ˆì´ë‘ í›ˆë ¨ì¥ë ¤ê¸ˆì„ ë™ì‹œì— ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?",
        "answer": "ë„¤. êµ­ë¯¼ì·¨ì—…ì œë„ (êµ­ì·¨ì œ) ì¥ë ¤ê¸ˆê³¼ í›ˆë ¨ì¥ë ¤ê¸ˆì€ ë³„ë„ì´ê¸°ì— ë™ì‹œì— ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìœ¼ì‹­ë‹ˆë‹¤."
    },
    "ë‹¹ì¼_ì¶œê²°": {
        "keywords": ["ì…ì‹¤", "ì •ìƒ", "HRD", "ê²°ì„", "í‡´ì‹¤"],
        "question": "ì˜¤ëŠ˜ ì…ì‹¤ì„ ì •ìƒì ìœ¼ë¡œ í–ˆëŠ”ë° HRD ì–´í”Œ ë‚´ ì—ì„œëŠ” ê²°ì„ìœ¼ë¡œ ë‚˜ì™€ìš”",
        "answer": "ë‹¹ì¼ ì¶œê²°ì˜ ê²½ìš° í‡´ì‹¤ê¹Œì§€ ì™„ì „í•˜ê²Œ ì°í˜€ì•¼ ë‹¹ì¼ ì¶œê²°ì´ ì¶œì„ìœ¼ë¡œ ì¸ì •ë©ë‹ˆë‹¤. ì•„ì§ ìˆ˜ì—… ì¤‘ì´ì‹œë©´ ê²°ì„ìœ¼ë¡œ ë‚˜ì˜¤ëŠ”ê²Œ ì •ìƒì…ë‹ˆë‹¤ :)"
    },
    "í•´ì™¸_ìˆ˜ì—…ì°¸ì—¬": {
        "keywords": ["í•´ì™¸ì—¬í–‰", "ìˆ˜ì—…ì‹œê°„", "ì°¸ì—¬", "ê°€ëŠ¥", "ì ‘ì†"],
        "question": "í•´ì™¸ ì—¬í–‰ì„ ê°€ì§€ë§Œ ìˆ˜ì—…ì‹œê°„ ë‚´ ì¼ì •ì´ ì—†ì–´ ì°¸ì—¬ê°€ ê°€ëŠ¥í•  ê±° ê°™ì€ë° ì°¸ì—¬í•´ë„ ë ê¹Œìš”?",
        "answer": "KDT êµìœ¡ê³¼ì •ì€ êµ­ë‚´ì—ì„œë§Œ ì œê³µ ë˜ëŠ” êµìœ¡ê³¼ì •ì´ê¸°ì— í•´ì™¸ì—ì„œëŠ” ì ˆëŒ€ì ìœ¼ë¡œ ì ‘ì†ì´ ë¶ˆê°€í•©ë‹ˆë‹¤. í•´ì™¸ì—ì„œ ì ‘ì†í•˜ì…”ì„œ ì´ì— ë”°ë¥¸ ë¶ˆì´ìµì€ ë‹¹ì‚¬ì ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤"
    },
    "ì¥ì†Œ_ì´ë™": {
        "keywords": ["í›ˆë ¨", "ì´ë™", "ì¥ì†Œ", "ë¶ˆê°€í”¼", "êµìœ¡ë§¤ë‹ˆì €"],
        "question": "í›ˆë ¨ ì¤‘ ì´ë™ì„ í•˜ê²Œ ë˜ë©´ ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?",
        "answer": "KDT í›ˆë ¨ ì¤‘ ì¥ì†Œ ì´ë™ì€ ë¶ˆê°€í•©ë‹ˆë‹¤. ì¥ì†Œì´ë™ì´ ë¶ˆê°€í”¼í•œ ìƒí™©ì´ì‹œë¼ë©´ ë‹´ë‹¹ êµìœ¡ ë§¤ë‹ˆì €ê»˜ ë‚´ìš©ì„ ë¨¼ì € ë§ì”€í•´ì£¼ì…”ì•¼ ë¶ˆì´ìµì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
    },
    "QRì½”ë“œ_ê°œì¸ì†Œì§€": {
        "keywords": ["ì…í‡´ì‹¤", "QRì½”ë“œ", "ê°œì¸", "ë³´ê´€", "ì†Œì§€"],
        "question": "ì…í‡´ì‹¤ QRì½”ë“œë¥¼ ê°œì¸ì ìœ¼ë¡œ ë³´ê´€í•´ë„ ë ê¹Œìš”?",
        "answer": "QRì½”ë“œëŠ” í›ˆë ¨ê¸°ê´€ì—ì„œ ì œê³µì„ í•˜ëŠ” ê²ƒì´ë¯€ë¡œ ê°œì¸ ì†Œì§€ê°€ ì ˆëŒ€ì ìœ¼ë¡œ ë¶ˆê°€í•©ë‹ˆë‹¤. ê°œì¸ ì†Œì§€ ë° ì‚¬ìš©ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ëª¨ë“  ë¶ˆì´ìµì€ ë‹¹ì‚¬ìì—ê²Œ ìˆìŠµë‹ˆë‹¤."
    },
    "ë‹¨ìœ„ê¸°ê°„_ì •ì˜": {
        "keywords": ["ë‹¨ìœ„ê¸°ê°„", "ë¬´ì—‡", "1ë‹¬", "ê°œê°•"],
        "question": "ë‹¨ìœ„ê¸°ê°„ì´ ë¬´ì—‡ì¸ê°€ìš”?",
        "answer": "ë‹¨ìœ„ê¸°ê°„ì€ êµìœ¡ ì‹œì‘ì„ ê¸°ì ìœ¼ë¡œ 1ë‹¬ì„ ë§í•©ë‹ˆë‹¤.\nì˜ˆë¥¼ ë“¤ì–´ 1ì›”5ì¼ ê°œê°•ì‹œ 1ì›” 5ì¼ë¶€í„° 2ì›” 4ì¼ê¹Œì§€ê°€ ì²« ë²ˆì§¸ ë‹¨ìœ„ê¸°ê°„ì´ ë©ë‹ˆë‹¤."
    },
    "ì¤Œ_ì°¸ì—¬í•„ìˆ˜": {
        "keywords": ["ì¤Œ", "ì°¸ì—¬", "í•„ìˆ˜", "ì†¡ì¶œ", "ì¶œì„ì²´í¬"],
        "question": "ìˆ˜ì—…ì— ê¼­ ì¤Œ ì°¸ì—¬ë¥¼ í•´ì•¼í•˜ë‚˜ìš”?",
        "answer": "ë„¤, ìˆ˜ì—…ì´ ì§„í–‰ë˜ëŠ” 9ì‹œë¶€í„° 18ì‹œê¹Œì§€ ê¼­ ì¤Œì— ì°¸ì—¬í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤.\nì¤Œì€ ìˆ˜ì—… ì†¡ì¶œìš©ë„ë¡œë„ ì‚¬ìš©ë˜ì§€ë§Œ ìˆ˜ê°•ìƒë“¤ì˜ ì¶œì„ ì²´í¬ë¡œë„ ì‚¬ìš©ë˜ëŠ” ì¤‘ìš”í•œ íˆ´ì…ë‹ˆë‹¤.\nì‰¬ëŠ”ì‹œê°„ê³¼ ì ì‹¬ì‹œê°„ ì™¸ ì¤Œì— ì°¸ì—¬ë¥¼ í•˜ì§€ ì•Šìœ¼ì‹œê±°ë‚˜ ìº ì„ ë„ì‹œë©´ ê²°ì„/ì§€ê° ì²˜ë¦¬ê°€ ë˜ë©°,\ní›ˆë ¨ì¥ë ¤ê¸ˆ ë¶€ì •ìˆ˜ê¸‰ê¹Œì§€ ì—°ê²°ë  ìˆ˜ ìˆëŠ” ì¤‘ìš”í•œ ì‚¬ì•ˆì…ë‹ˆë‹¤."
    },
    "í›ˆë ¨ì¥ë ¤ê¸ˆ_ê¸ˆì•¡": {
        "keywords": ["í›ˆë ¨ì¥ë ¤ê¸ˆ", "ì–¼ë§ˆ", "ì¼ì¼", "ì§€ê¸‰", "ê³„ì‚°"],
        "question": "í›ˆë ¨ì¥ë ¤ê¸ˆì€ ì–¼ë§ˆì¸ê°€ìš”?",
        "answer": "í›ˆë ¨ì¥ë ¤ê¸ˆì€ í•˜ë£¨ ìˆ˜ì—…ì„ ëª¨ë‘ ì°¸ì—¬ì‹œ ì¼ì¼ 15,800ì›ì´ ì§€ê¸‰ë©ë‹ˆë‹¤.\në‹¤ë§Œ ì§€ê°/ì¡°í‡´/ì™¸ì¶œ/ê²°ì„ì‹œ 15,800ì›ì˜ í›ˆë ¨ì¥ë ¤ê¸ˆ ì§€ê¸‰ì´ ì–´ë ¤ìš°ë©°,\nì›” ë³„ í›ˆë ¨ì¥ë ¤ê¸ˆì€ ë‹¨ìœ„ê¸°ê°„ ë³„ \"ì •ìƒ ì¶œì„ì¼ * 15,800ì›\"ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤."
    },
    "ì²˜ë°©ì „_ì„œë¥˜": {
        "keywords": ["ì²˜ë°©ì „", "ì„œë¥˜", "ì¸ì •", "ì§„ë£Œí™•ì¸ì„œ", "ì§„ë‹¨ì„œ"],
        "question": "ë³‘ì› ë°©ë¬¸ì‹œ ì²˜ë°©ì „ì€ ì„œë¥˜ ì¸ì •ì´ ì–´ë ¤ìš´ê°€ìš”?",
        "answer": "ì²˜ë°©ì „ì€ ì„œë¥˜ ì¸ì •ì´ ì–´ë µìŠµë‹ˆë‹¤.\nì§ˆë³‘ëª… í˜¹ì€ ì§ˆë³‘ì½”ë“œê°€ ê¸°ì¬ëœ ì§„ë£Œí™•ì¸ì„œ, ì…í‡´ì› í™•ì¸ì„œ, ì§„ë‹¨ì„œë¡œ ì œì¶œ ë¶€íƒë“œë¦½ë‹ˆë‹¤."
    },
    "ë…¹í™”ë³¸_ì œê³µ": {
        "keywords": ["ë…¹í™”ë³¸", "ì œê³µ", "ì§€ê°", "ì™¸ì¶œ", "ì¡°í‡´", "ê²°ì„"],
        "question": "ìµì¼ ì§€ê°/ì™¸ì¶œ/ì¡°í‡´/ê²°ì„ ì˜ˆì •ì¸ë°, ë…¹í™”ë³¸ ì œê³µì´ ê°€ëŠ¥í•œê°€ìš”?",
        "answer": "ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ ë¶€íŠ¸ìº í”„ëŠ” ì‹¤ì‹œê°„ ì˜¨ë¼ì¸ ê°•ì˜ë¡œ ì§„í–‰ë˜ê¸° ë•Œë¬¸ì—, ë…¹í™”ë³¸ ì œê³µì€ ë”°ë¡œ ì§„í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê°•ì‚¬ë‹˜ì´ ì˜¬ë ¤ì£¼ì‹  êµì•ˆ í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤."
    },
    "ìˆ˜ê°•ì¦ëª…ì„œ_ë°œê¸‰": {
        "keywords": ["ì‹¤ì—…ê¸‰ì—¬", "ì¶œì„ë¶€", "ìˆ˜ê°•ì¦ëª…ì„œ", "ê¸‰í•´", "ë°œê¸‰"],
        "question": "ì‹¤ì—…ê¸‰ì—¬ ì œì¶œìš©ìœ¼ë¡œ ê¸‰í•´ì„œ ê·¸ëŸ¬ëŠ”ë° ì˜¤ëŠ˜ ì¤‘ìœ¼ë¡œ ë°œê¸‰ ê°€ëŠ¥í•œê°€ìš”?",
        "answer": "í•´ë‹¹ ë‚´ìš©ì€ ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ êµìœ¡í–‰ì • ë””ìŠ¤ì½”ë“œ ì„œë²„ì—ì„œ í›ˆë ¨ìƒ ë¶„ì´ ìˆ˜ê°•í•˜ê³  ìˆëŠ” ë¶€íŠ¸ìº í”„ ì¹´í…Œê³ ë¦¬ì—ì„œ ì„œë¥˜ìš”ì²­ ë€ì— ì‘ì„±í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤. ì›ì¹™ì ìœ¼ë¡œ ì˜ì—…ì¼ ê¸°ì¤€ 2-3ì¼ ì´ì „ì— ì‘ì„±í•´ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤."
    },
    "í‡´ì‹¤QR_ì •ì •": {
        "keywords": ["í‡´ì‹¤QR", "ì•ˆì°ìŒ", "ì •ì •", "ê°œì¸ë¶€ì£¼ì˜"],
        "question": "í‡´ì‹¤ QR ì•ˆ ì°ì—ˆëŠ”ë° ì •ì • ê°€ëŠ¥í•œê°€ìš”?",
        "answer": "ìš°ì„ , ì›ì¹™ì ìœ¼ë¡œ ê°œì¸ë¶€ì£¼ì˜ í•­ëª©ì— í•´ë‹¹í•˜ê¸° ë•Œë¬¸ì— ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.\n\në‹¤ë§Œ 1ë‹¨ìœ„ê¸°ê°„ì¸ ê²½ìš° (ê°œê°• ì´í›„ 1ê°œì›” ì´ë‚´) QR ë¯¸ìˆ™ ê±´ìœ¼ë¡œ ì •ì •ì‹ ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\nì •ì • ì¦ë¹™ìë£Œë¡œëŠ” í›ˆë ¨ìƒ ë¶„ì´ í•´ë‹¹ì¼ ì…ì‹¤/ì¤‘ê°„/í‡´ì‹¤ ìŠ¤í¬ë¦°ìƒ·ì— ëˆˆâ€¢ì½”â€¢ì… ì´ ëª¨ë‘ ëª…í™•í•˜ê²Œ ë‚˜ì™€ì•¼í•˜ë©°, 09:00 - 18:00 ì¤Œ ì ‘ì†ê¸°ë¡ì´ í•„ìš”í•©ë‹ˆë‹¤."
    },
    "ì‹¤ì—…ê¸‰ì—¬_êµ­ì·¨ì œ": {
        "keywords": ["ì‹¤ì—…ê¸‰ì—¬", "êµ­ì·¨ì œ", "ì„œë¥˜", "ì œì¶œ", "ê³µê°€"],
        "question": "ì‹¤ì—…ê¸‰ì—¬ ì„œë¥˜ ì œì¶œ ë°©ë¬¸ / êµ­ì·¨ì œ ì„œë¥˜ ì œì¶œ ë°©ë¬¸ìœ¼ë¡œ ì¸í•œ ë¶€ì¬ëŠ” ê³µê°€ì‹ ì²­ì´ ê°€ëŠ¥í•œê°€ìš”?",
        "answer": "í•´ë‹¹ ë‚´ìš©ì€ ê³µê°€ì‹ ì²­ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ìì„¸í•œ ì‚¬í•­ì€ OT ë•Œ ì•ˆë‚´ë“œë¦° ê³µê°€ì¸ì •ì‹ ì²­í‘œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."
    },
    "í”„ë¡œì íŠ¸_ìˆ˜ì •": {
        "keywords": ["í”„ë¡œì íŠ¸", "ì œì¶œ", "ìˆ˜ì •", "ë§í¬", "LMS"],
        "question": "í”„ë¡œì íŠ¸ ì œì¶œ ì´í›„ ìˆ˜ì • ê±´ì´ ìƒê²¨, ë§í¬ë¥¼ ìˆ˜ì •í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ê°€ëŠ¥í• ê¹Œìš”?",
        "answer": "ë„¤, ê°€ëŠ¥í•©ë‹ˆë‹¤. ìì„¸í•œ ì‚¬í•­ì€ ìˆ˜ê°•í•˜ê³  ìˆëŠ” ë¶€íŠ¸ìº í”„ ë‹´ë‹¹ ë§¤ë‹ˆì € ë‹˜ì—ê²Œ ë¬¸ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤."
    },
    "ì¡¸ì—…ì‹_ê³µê²°": {
        "keywords": ["ì¡¸ì—…ì‹", "ê³µê²°", "ì‹ ì²­", "íœ´ê°€"],
        "question": "ì¡¸ì—…ì‹ë„ ê³µê²°ì‹ ì²­ì´ ê°€ëŠ¥í•œê°€ìš”?",
        "answer": "ì¡¸ì—…ì‹ì€ ê³µê²°ì¸ì • ì‚¬ìœ ì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë©°, íœ´ê°€ì‹ ì²­ì´ ê°€ëŠ¥í•œ ê³¼ì •ì—ì„œëŠ” íœ´ê°€ì‹ ì²­ í›„ ë‹¤ë…€ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íœ´ê°€ê°€ ì—†ëŠ” ê³¼ì •ì˜ ê²½ìš°, ê³µê²° ë¶ˆì¸ì •ë˜ë‹ˆ ì°¸ê³  ë¶€íƒë“œë¦½ë‹ˆë‹¤."
    },
    "ì¡°ëª¨ìƒ_ê³µê²°": {
        "keywords": ["ì¡°ëª¨ìƒ", "ê³µê²°", "3ì¼", "ì‚¬ìœ ë°œìƒì¼", "ì£¼ë§"],
        "question": "ê¸ˆìš”ì¼ì— ì¡°ëª¨ìƒì„ ë‹¹í–ˆìŠµë‹ˆë‹¤. ê³µê²°ì¸ì •ì´ 3ì¼ì´ë¼ê³  ë‚˜ì™€ìˆëŠ”ë°, ì°¨ì£¼ ì›”~í™”ê¹Œì§€ ê³µê²°ë¡œ ì¸ì •ë˜ë‚˜ìš”?",
        "answer": "ì¡°ëª¨ìƒì˜ ê²½ìš°, ê³µê²°ì€ ì‚¬ìœ ë°œìƒì¼ë¡œë¶€í„° 3ì¼ê¹Œì§€ ì¸ì •ë©ë‹ˆë‹¤. ë‹¨, ì£¼ë§ì€ ê¸°ì‚°í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì°¨ì£¼ ì›”ìš”ì¼ë¶€í„°ëŠ” ê³µê²°ë¡œ ì¸ì •ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
    },
    "í›ˆë ¨ì¥ë ¤ê¸ˆ_ì§€ê¸‰ì‹œê¸°": {
        "keywords": ["í›ˆë ¨ì¥ë ¤ê¸ˆ", "ì–¸ì œ", "ë°›ê¸°", "ë‹¨ìœ„ê¸°ê°„", "2ì£¼"],
        "question": "í›ˆë ¨ì¥ë ¤ê¸ˆì€ ì–¸ì œ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?",
        "answer": "í›ˆë ¨ì¥ë ¤ê¸ˆì€ í•´ë‹¹ ê³¼ì •ì˜ ë‹¨ìœ„ê¸°ê°„ ë§ˆê°ì¼ì„ ê¸°ì¤€ìœ¼ë¡œ ì§€ê¸‰ê¹Œì§€ 2ì£¼ì—ì„œ 3ì£¼ ê°€ëŸ‰ ì†Œìš”ë©ë‹ˆë‹¤\n1ë‹¨ìœ„ê¸°ê°„ì˜ ê²½ìš°, í™•ì¸í•  ì‚¬í•­ì´ ë§ì•„ ì‹œê°„ì´ ë‹¤ì†Œ ì†Œìš”ë  ìˆ˜ ìˆë‹¤ëŠ” ì  ì°¸ê³  ë¶€íƒë“œë¦½ë‹ˆë‹¤."
    },
    "ì¬í•™ìƒ_ë§ì¶¤í˜•": {
        "keywords": ["ì¬í•™ìƒ", "ë§ì¶¤í˜•", "ê³ ìš©ì„œë¹„ìŠ¤", "ì í”„ì—…", "ë¹Œë“œì—…"],
        "question": "í˜„ì¬ ì¬í•™ìƒ ë§ì¶¤í˜• ê³ ìš©ì„œë¹„ìŠ¤ ì‚¬ì—…ì— ì°¸ì—¬ ì¤‘ì…ë‹ˆë‹¤. í›ˆë ¨ì¥ë ¤ê¸ˆ ë°›ì„ ìˆ˜ ìˆì„ê¹Œìš”?",
        "answer": "ì¬í•™ìƒ ë§ì¶¤í˜• ê³ ìš©ì„œë¹„ìŠ¤(ì¼ëª… ì í”„ì—…í”„ë¡œì íŠ¸, ë¹Œë“œì—…í”„ë¡œì íŠ¸)ì— ì°¸ì—¬ ì¤‘ì´ë©´ì„œ ìˆ˜ë‹¹ì„ ì§€ê¸‰ë°›ê³  ìˆëŠ” ê²½ìš°ì—ëŠ” í›ˆë ¨ì¥ë ¤ê¸ˆê³¼ ì¤‘ë³µì´ ë¶ˆê°€í•©ë‹ˆë‹¤. ë‹¨, í•™êµì¸¡ì—ì„œ ë°œê¸‰í•´ì£¼ëŠ” ì°¸ì—¬í™•ì¸ì„œ ìƒì— í•´ë‹¹ ê³¼ì • í›ˆë ¨ê¸°ê°„ ì¤‘ ì–´ë– í•œ ìˆ˜ë‹¹ë„ ì§€ê¸‰ë°›ì§€ ì•Šì•˜ë‹¤ëŠ” ì‚¬ì‹¤ì´ ì¦ë¹™ë˜ë©´ í›ˆë ¨ì¥ë ¤ê¸ˆ ì§€ê¸‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    },
    "ì‚¬ì—…ì²´_ì •ë¦¬": {
        "keywords": ["ì‚¬ì—…ì²´", "ì •ë¦¬", "ìì˜ì—…ì", "íì—…", "ì¦ëª…ì›"],
        "question": "ì‚¬ì—…ì²´ë¥¼ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤. í›ˆë ¨ì¥ë ¤ê¸ˆì„ ë°›ì„ ìˆ˜ ìˆì„ê¹Œìš”?",
        "answer": "í˜„ì¬ ì‹œìŠ¤í…œ ìƒì— (ì˜ì„¸)ìì˜ì—…ìë¡œ ë“±ë¡ëœ ê²½ìš°, ì‚¬ì—…ìë“±ë¡ì¦ì„ ê°–ê³  ìˆë‹¤ëŠ” ê²ƒë§Œìœ¼ë¡œë„ í›ˆë ¨ì¥ë ¤ê¸ˆì´ ë¶€ì§€ê¸‰ ì²˜ë¦¬ ë©ë‹ˆë‹¤.\në‹¨, ì‚¬ì—…ì²´ë¥¼ ì •ë¦¬í•˜ì—¬ íì—…ì‚¬ì‹¤ì¦ëª…ì›ì„ ì œì¶œí•˜ë©´ íì—…ì¼ ì´í›„ë¶€í„° ì¼í• ê³„ì‚°ë˜ì–´ ì§€ê¸‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    },
    "ì›¹ìº _í•„ìš”": {
        "keywords": ["ì›¹ìº ", "í•„ìš”", "êº¼ë„", "ê°œê°•ì „", "êµ¬ë¹„"],
        "question": "ì›¹ìº ì´ í•„ìš”í•œê°€ìš”? êº¼ë†”ë„ ë˜ë‚˜ìš”? (ë©‹ì‚¬ì—ì„œëŠ” ë‹¹ì—°í•˜ë‹¤ê³  ìƒê°í•˜ì—¬ ìƒí˜ì— ì›¹ìº êµ¬ë¹„ ì•ˆì¨ìˆìŒ)",
        "answer": "ì˜¤í”„ë¼ì¸ê³¼ ë™ì¼í•˜ê²Œ ì§„í–‰í•˜ëŠ” ì˜¨ë¼ì¸ ìˆ˜ì—…ì´ê¸°ë•Œë¬¸ì— 'ê°œê°• ì „' ë°˜ë“œì‹œ ì›¹ìº ì€ êµ¬ë¹„í•˜ì…”ì•¼ í•˜ê³  ë¶ˆê°€í•  ì‹œ í°ì´ë‚˜ íƒœë¸”ë¦¿ ìœ¼ë¡œë¼ë„ ì ‘ì†ì„ í•´ì•¼ í•¨ì„ ì•ˆë‚´"
    },
    "ì¤Œ_ë‘ê°œì ‘ì†": {
        "keywords": ["ê°•ì˜", "ìˆ˜ê°•ìš©", "PC", "ì‹¤ìŠµìš©", "ë°ìŠ¤í¬íƒ‘", "ë‘ê°œ"],
        "question": "ê°•ì˜ ìˆ˜ê°•ìš© PCë‘ ì‹¤ìŠµìš© ë°ìŠ¤í¬íƒ‘ ë‘ê°œë¡œ ì¤Œ ì ‘ì†í•´ë„ ë˜ë‚˜ìš”?",
        "answer": "ìˆ˜ê°•ìš© PCë¥¼ ë³„ë„ë¡œ ë‘˜ ê²½ìš° ì¤Œ ì ‘ì†ì€ 'í™ê¸¸ë™ - ìˆ˜ê°•ìš©'ìœ¼ë¡œ ì ‘ì†í•´ ë‹¬ë¼ê³  ë‹µë³€"
    },
    "ì‰¬ëŠ”ì‹œê°„_ì¹´ë©”ë¼": {
        "keywords": ["ì‰¬ëŠ”ì‹œê°„", "ì¹´ë©”ë¼", "êº¼ë„", "ì–¼êµ´", "ë…¸ì¶œ"],
        "question": "ì‰¬ëŠ” ì‹œê°„ì— ì¹´ë©”ë¼ êº¼ë„ ë˜ë‚˜ìš”?",
        "answer": "ëœë‹¤ê³  ë‹µë³€ ë‹¤ë§Œ, ëª¨ë“  ìˆ˜ì—…ì‹œê°„ì—ëŠ” ì–¼êµ´ ë…¸ì¶œ í•„ìˆ˜ë¥¼ ì•ˆë‚´"
    },
    "êµì¬_ë‹¤ë¦„": {
        "keywords": ["êµì¬", "ë°°ì†¡", "ê°•ì˜ë‚´ìš©", "ë‹¤ë¥¸", "ì°¸ê³ ìë£Œ"],
        "question": "êµì¬ ë°°ì†¡ë°›ì€ê±°ë‘ ê°•ì˜ë‚´ìš©ì´ ë‹¤ë¥¸ë°ìš”?",
        "answer": "ë°°ì†¡ëœ êµì¬ëŠ” ì°¸ê³ ìë£Œë¡œ ì‚¬ìš©í•˜ëŠ” ìš©ë„ì´ë©°, ì£¼ ê°•ì˜ìë£ŒëŠ” ì£¼ê°•ì‚¬ë‹˜ì´ ì‘ì„±í•´ì£¼ì‹œëŠ” ë‚´ìš©ìœ¼ë¡œ ê°•ì˜í•©ë‹ˆë‹¤."
    },
    "ì§ˆì˜ì‘ë‹µ": {
        "keywords": ["ìˆ˜ì—…", "ë§ˆì¹˜ê³ ", "ê¶ê¸ˆí•œ", "ë””ì½”", "ë¬¼ì–´ë´ë„"],
        "question": "ìˆ˜ì—… ë§ˆì¹˜ê³  ê¶ê¸ˆí•œê±° ìƒê¸°ë©´ ë””ì½”ì— ë¬¼ì–´ë´ë„ ë˜ë‚˜ìš”?",
        "answer": "ìˆ˜ì—…ê´€ë ¨ ë¬¸ì˜ëŠ” ìˆ˜ì—…ì‹œê°„ ì´ë‚´ë¥¼ í™œìš©í•´ ì£¼ì„¸ìš”. ì•¼ê°„ ë‹µë³€ì€ ì–´ë µìŠµë‹ˆë‹¤."
    },
    "í‰ê°€_ì„¤ë¬¸": {
        "keywords": ["í‰ê°€", "ì„¤ë¬¸", "í”„ë¡œì íŠ¸", "ì œì¶œ", "ê¸°ê°„"],
        "question": "í‰ê°€, ì„¤ë¬¸, í”„ë¡œì íŠ¸ ì œì¶œ ê¸°ê°„ ì§€ë‚œ í›„ì— ë‹¤ì‹œí•˜ê³  ì‹¶ì–´ìš”.",
        "answer": "ê¸°ê°„ì´ ì§€ë‚œí›„ëŠ” ë¶ˆê°€ í•¨ì„ ì•ˆë‚´"
    },
    "ìˆ˜ë£Œìƒ_DB": {
        "keywords": ["í›ˆë ¨ìƒ", "ìˆ˜ë£Œìƒ", "DB", "ì„¤ë¬¸ì¡°ì‚¬", "ì‘ë‹µ"],
        "question": "í›ˆë ¨ìƒ/ìˆ˜ë£Œìƒ DB ì„¤ë¬¸ì¡°ì‚¬ì— ê¼­ ì‘ë‹µí•´ì•¼ í•˜ë‚˜ìš”?",
        "answer": "ìˆ˜ë£Œìƒ DB ì„¤ë¬¸ì¡°ì‚¬ëŠ” ìˆ˜ë£Œ í›„ ì·¨ì—… ì—°ê³„ í”„ë¡œê·¸ë¨ ìš´ì˜ì„ ìœ„í•œ ì¤‘ìš”í•œ ê¸°ì´ˆ ìë£Œì¼ ë¿ë§Œ ì•„ë‹ˆë¼, B2B ì±„ìš© ì—°ê³„ ì§„í–‰ì— ìˆì–´ ê¼­ í•„ìš”í•œ ì •ë³´ë¥¼ ì·¨í•©í•˜ëŠ” ì ˆì°¨ì…ë‹ˆë‹¤.\në”°ë¼ì„œ, ë‹¤ì†Œ ë²ˆê±°ë¡œìš°ì‹œë”ë¼ë„ ì„¤ë¬¸ì¡°ì‚¬ ë‚´ ëª¨ë“  í•­ëª©ì— ëŒ€í•´ ì •í™•í•˜ê²Œ ì‘ë‹µí•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤."
    },
    "íŠ¹ê°•_ì„œë¥˜ì‘ì„±": {
        "keywords": ["ì´ë ¥ì„œ", "ìê¸°ì†Œê°œì„œ", "í¬íŠ¸í´ë¦¬ì˜¤", "ì‘ì„±", "ë°©ë²•"],
        "question": "ì´ë ¥ì„œ, ìê¸°ì†Œê°œì„œ, í¬íŠ¸í´ë¦¬ì˜¤ ì‘ì„± ë°©ë²•ì„ ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?",
        "answer": "2025ë…„ 2ì›” í˜„ì¬ ë©‹ì‚¬ KDT ìˆ˜ë£Œìƒì„ ìœ„í•œ ì„œë¥˜/ë©´ì ‘ ì „í˜• ì¤€ë¹„ ë°©ë²• íŠ¹ê°• VOD ìë£Œë¥¼ ì¤€ë¹„ ì¤‘ì— ìˆìŠµë‹ˆë‹¤.\ní•´ë‹¹ ìë£Œê°€ ì¤€ë¹„ë˜ëŠ”ëŒ€ë¡œ ê° êµìœ¡ê³¼ì •ë³„ ë””ìŠ¤ì½”ë“œ ë° ìˆ˜ë£Œìƒ ë””ìŠ¤ì½”ë“œ(ì„¸ë ê²Œí‹°)ë¥¼ í†µí•´ ê´€ë ¨ ì‚¬í•­ì„ ë³„ë„ ê³µì§€ ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤."
    },
    "ì»¤ë¦¬ì–´_ìƒë‹´": {
        "keywords": ["ì„œë¥˜", "ë©´ì ‘", "ì¤€ë¹„", "ì»¤ë¦¬ì–´", "ì½”ì¹˜", "ìƒë‹´"],
        "question": "ì„œë¥˜ ì „í˜•, ë©´ì ‘ ì „í˜• ì¤€ë¹„ ê³¼ì •ì—ì„œ ì»¤ë¦¬ì–´ ì½”ì¹˜ë‹˜ì˜ ìƒë‹´ì„ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?",
        "answer": "2025ë…„ 2ì›” í˜„ì¬ ë©‹ì‚¬ í™ˆí˜ì´ì§€ ë‚´ LMS ì‹œìŠ¤í…œì„ í™œìš©í•œ ìƒë‹´ í”„ë¡œê·¸ë¨ ì‹ ì„¤ì„ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤.\ní•´ë‹¹ í”„ë¡œê·¸ë¨ ìš´ì˜ì´ ì‹œì‘ë˜ëŠ”ëŒ€ë¡œ ê° êµìœ¡ê³¼ì •ë³„ ë””ìŠ¤ì½”ë“œ ë° ìˆ˜ë£Œìƒ ë””ìŠ¤ì½”ë“œ(ì„¸ë ê²Œí‹°)ë¥¼ í†µí•´ ê³µì§€ ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤."
    },
    "ì±„ìš©_ì—°ê³„": {
        "keywords": ["ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼", "KDT", "ìˆ˜ë£Œìƒ", "ì±„ìš©", "ì—°ê³„"],
        "question": "ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ KDT ìˆ˜ë£Œìƒì„ ìœ„í•œ ì±„ìš© ì—°ê³„ í”„ë¡œê·¸ë¨ë„ ìˆë‚˜ìš”?",
        "answer": "ë©‹ì‚¬ KDT ìˆ˜ë£Œìƒì„ ìœ„í•´ ë‹¤ì–‘í•œ íšŒì‚¬ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì±„ìš© ì—°ê³„ ê¸°íšŒë¥¼ ë°œêµ´ ì¤‘ì— ìˆìœ¼ë©°, ì‹ ê·œ í¬ì§€ì…˜ ì˜¤í”ˆ ì‹œ ê°œë³„ ê³µì§€ë¥¼ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.\në”°ë¼ì„œ, ê°œë³„ ê³µì§€ ì‹œ ë¹ ë¥´ê²Œ ì§€ì› ì ˆì°¨ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ ì–¸ì œë“ ì§€ ì œì¶œ ê°€ëŠ¥í•œ ì´ë ¥ì„œ/ìê¸°ì†Œê°œì„œ/í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì¤€ë¹„í•´ì£¼ì‹œê¸¸ ë¶€íƒ ë“œë¦½ë‹ˆë‹¤."
    },
    "ì¸í„´ì‹­": {
        "keywords": ["ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼", "KDT", "ìˆ˜ë£Œìƒ", "ì¸í„´ì‹­", "í¬ë¡œìŠ¤ë„ë©”ì¸"],
        "question": "ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ KDT ìˆ˜ë£Œìƒë§Œì„ ìœ„í•œ ì¸í„´ì‹­ í”„ë¡œê·¸ë¨ë„ ìˆë‚˜ìš”?",
        "answer": "ë©‹ì‚¬ KDT ë¶€íŠ¸ìº í”„ ì¤‘ ì¼ë¶€ ê³¼ì •ì€ ìˆ˜ë£Œìƒ ì „ìš© í¬ë¡œìŠ¤ ë„ë©”ì¸ ì¸í„´ì‹­ í”„ë¡œê·¸ë¨ì„ ìš´ì˜ ì¤‘ì— ìˆìŠµë‹ˆë‹¤.\nêµ¬ì²´ì ì¸ ìš´ì˜ ì‹œê¸°/í˜•íƒœëŠ” ê¸°ìˆ˜ë³„ë¡œ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— êµ¬ì²´ì ì¸ ì‚¬í•­ì€ ê°œë³„ ì•ˆë‚´ ì‹œ í•´ë‹¹ ê³µì§€ ë‚´ìš©ì„ ì°¸ì¡°í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤."
    },
    "ì„¸ë ê²Œí‹°": {
        "keywords": ["ì·¨ì—…", "ì§€ì›", "í”„ë¡œê·¸ë¨", "ì†Œì‹", "ê³µì§€"],
        "question": "ì·¨ì—… ì§€ì› í”„ë¡œê·¸ë¨ ì†Œì‹ì€ ì–´ë””ë¡œ ê³µì§€ë˜ë‚˜ìš”?",
        "answer": "ì»¤ë¦¬ì–´íŒ€ ì‹œí–‰ ì·¨ì—…ì§€ì› í”„ë¡œê·¸ë¨ì˜ ê²½ìš°, ë©‹ì‚¬ KDT ìˆ˜ë£Œìƒ ì»¤ë®¤ë‹ˆí‹°ì¸ ë””ìŠ¤ì½”ë“œ ì„¸ë ê²Œí‹° ì±„ë„ì„ í†µí•´ ê°€ì¥ ìš°ì„ ì ìœ¼ë¡œ ê³µì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.\ní–¥í›„ ë‹¤ì–‘í•œ ì·¨ì—… ê´€ë ¨ ì •ë³´ë„ ì„¸ë ê²Œí‹°ë¥¼ í†µí•´ ê³µì§€í•  ì˜ˆì •ì´ë‹ˆ KDT ë¶€íŠ¸ìº í”„ ìˆ˜ë£Œ í›„ì—ëŠ” ê¼­ ì„¸ë ê²Œí‹°ì— ê°€ì…í•´ì£¼ì‹œê¸¸ ë¶€íƒ ë“œë¦½ë‹ˆë‹¤.\n(ë””ìŠ¤ì½”ë“œ ì„¸ë ê²Œí‹° ê°€ì… ì£¼ì†Œ : KDT ë¶€íŠ¸ìº í”„ ìˆ˜ë£Œ ì‹œ ê° êµìœ¡ê³¼ì • ë‹´ë‹¹ìë¥¼ í†µí•´ ì•ˆë‚´)"
    },
    "íœ´ê°€": {
        "keywords": ["íœ´ê°€", "êµìœ¡ê¸°ê°„", "6ê°œì›”", "í•œë‹¬", "í•œê°œ"],
        "question": "í•´ë‹¹ ê³¼ì •ì—ëŠ” íœ´ê°€ê°€ ìˆë‚˜ìš”? ë§¤ì¼ ìˆ˜ì—…ì´ ì§„í–‰ë˜ëŠ” ê±´ê°€ìš”?",
        "answer": "íœ´ê°€ëŠ” êµìœ¡ ê¸°ê°„ 6ê°œì›” ì´ìƒ ì§„í–‰ë˜ëŠ” ê³¼ì •ì— í•œí•˜ì—¬ í•œ ë‹¬ì— í•œ ê°œì”© ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nìì„¸í•œ ì‚¬í•­ì€ ë‹´ë‹¹ êµìœ¡ ë§¤ë‹ˆì €ë‹˜ê»˜ ë¬¸ì˜í•˜ì—¬ ì£¼ì„¸ìš”."
    },
    "ë‹¤ì‹œë³´ê¸°": {
        "keywords": ["ë³µìŠµ", "ë‹¤ì‹œë³´ê¸°", "ì œê³µ", "KDT", "ì§€ì¹¨"],
        "question": "ë³µìŠµì„ í•˜ê³  ì‹¶ì€ë° ë‹¤ì‹œë³´ê¸° ì œê³µì´ ë˜ë‚˜ìš”?",
        "answer": "KDT ì§€ì¹¨ ìƒ ë‹¤ì‹œë³´ê¸° ì œê³µì´ ì–´ë µìŠµë‹ˆë‹¤. ê¼­ í•´ë‹¹ êµìœ¡ ì‹œê°„ì— ì¶œì„í•˜ì—¬ êµìœ¡ì„ ë“¤ì–´ì£¼ì„¸ìš”."
    },
    "ë…¸íŠ¸ë¶_ëŒ€ì—¬": {
        "keywords": ["ë…¸íŠ¸ë¶", "ëŒ€ì—¬", "ì–´ë–»ê²Œ", "ê°œê°•ì¼", "ì¼ì£¼ì¼"],
        "question": "ë…¸íŠ¸ë¶ ëŒ€ì—¬ëŠ” ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ë‚˜ìš”?",
        "answer": "ê°œê°•ì¼ ê¸°ì¤€ ì¼ì£¼ì¼ ì´ë‚´ë¡œ ë…¸íŠ¸ë¶ ëŒ€ì—¬ ì‹ ì²­ì„ ë°›ì•„ ì‹ ì²­ìì— í•œí•˜ì—¬ ëŒ€ì—¬í•´ë“œë¦¬ê³  ìˆìŠµë‹ˆë‹¤."
    },
    "ì˜¤í”„ë¼ì¸_ê³µê°„": {
        "keywords": ["ì˜¤í”„ë¼ì¸", "ê³µê°„", "ëŒ€ì—¬", "ìƒì„¸í˜ì´ì§€", "í”„ë¡œì íŠ¸"],
        "question": "ìƒì„¸í˜ì´ì§€ ë‚´ì— ìˆëŠ” ì˜¤í”„ë¼ì¸ ê³µê°„ ëŒ€ì—¬ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
        "answer": "í”„ë¡œì íŠ¸ ê¸°ê°„ì— ì‹ ì²­ ì¡°ì— í•œí•˜ì—¬ ì˜¤í”„ë¼ì¸ ê³µê°„ì„ ëŒ€ì—¬í•´ë“œë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë¬¸ì˜ëŠ” ë‹´ë‹¹ êµìœ¡ ë§¤ë‹ˆì €ì—ê²Œ ë¬¸ì˜í•˜ì—¬ ì£¼ì„¸ìš”."
    },
    "êµì¬_ìˆ˜ë ¹": {
        "keywords": ["êµì¬", "ì–¸ì œ", "ë°›ê¸°", "ê°œê°•ì¼", "ë°°ì†¡"],
        "question": "êµì¬ëŠ” ì–¸ì œ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?",
        "answer": "(ìš´ì˜ê³„íšì„œ ìƒ êµì¬ê°€ ìˆëŠ” ê³¼ì •ì˜ ê²½ìš°ì—ë§Œ í•´ë‹¹) êµì¬ëŠ” ê°œê°•ì¼ ê¸°ì¤€ ì¼ì£¼ì¼ ì´ë‚´ë¡œ ì£¼ì†Œë¥¼ ì·¨í•©í•˜ì—¬ ë°°ì†¡í•´ë“œë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë¬¸ì˜ëŠ” ë‹´ë‹¹ êµìœ¡ ë§¤ë‹ˆì €ì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”."
    },
    "ê³„ì¢Œ_ë“±ë¡": {
        "keywords": ["í›ˆë ¨ì¥ë ¤ê¸ˆ", "ê³„ì¢Œ", "ë“±ë¡", "ê³ ìš©24", "ìš”ì²­"],
        "question": "í›ˆë ¨ ì¥ë ¤ê¸ˆ ê³„ì¢Œ ë“±ë¡ì€ ì–´ë–»ê²Œ í•˜ë‚˜ìš”?",
        "answer": "ê³ ìš©24 ì‚¬ì´íŠ¸ì— ì ‘ì†í•˜ì…”ì„œ ì§ì ‘ ë“±ë¡í•˜ì‹œê±°ë‚˜, êµìœ¡í–‰ì • ì±„ë„ì„ í†µí•´ í–‰ì • ë‹´ë‹¹ìë‹˜ë“¤ê»˜ ìš”ì²­í•˜ì‹œë©´ ë©ë‹ˆë‹¤!"
    }
}

# FastAPI ì•± ì´ˆê¸°í™”
app = FastAPI(
    title="ë¼ì´ì–¸ í—¬í¼ AI ì±—ë´‡ API",
    version="3.0.0",
    description="""
## ğŸ¤– ë¼ì´ì–¸ í—¬í¼ AI ì±—ë´‡ - í›ˆë ¨ìƒì„ ìœ„í•œ ìŠ¤ë§ˆíŠ¸ ë„ìš°ë¯¸ API

### ğŸ“š ì£¼ìš” ê¸°ëŠ¥
- ğŸ¤– **í•˜ì´ë¸Œë¦¬ë“œ AI ì±—ë´‡**: í‚¤ì›Œë“œ ê¸°ë°˜ + Ollama GPT ëª¨ë¸
- ğŸ“ **í›ˆë ¨ ê´€ë ¨ ì •ë³´**: í›ˆë ¨ì¥ë ¤ê¸ˆ, ì¶œê²°, ê³µê²° ê´€ë ¨ ì¦‰ì‹œ ë‹µë³€
- ğŸ–¥ï¸ **êµìœ¡ ì§€ì›**: ì¤Œ, ë…¸íŠ¸ë¶, êµì¬ ê´€ë ¨ ì•ˆë‚´
- ğŸ’¼ **ì»¤ë¦¬ì–´ ì§€ì›**: ì·¨ì—…, ì¸í„´ì‹­, í¬íŠ¸í´ë¦¬ì˜¤ ìƒë‹´
- ğŸ’¬ **ëŒ€í™” ê¸°ë¡ ê´€ë¦¬**: ì„¸ì…˜ë³„ ëŒ€í™” ë‚´ìš© ì €ì¥ ë° ê´€ë¦¬

### ğŸ”§ ì‹œìŠ¤í…œ êµ¬ì¡°
- **1ë‹¨ê³„**: í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ì‘ë‹µ (47ê°œ QA ë°ì´í„°ë² ì´ìŠ¤)
- **2ë‹¨ê³„**: AI ëª¨ë¸ ìƒì„± ì‘ë‹µ (Ollama GPT-OSS-20B)
- **ë°±ì—…**: ì—°ê²° ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì•ˆë‚´ ì‘ë‹µ

### ğŸ¯ ì§€ì› ì£¼ì œ
- **ğŸ’° í›ˆë ¨ì¥ë ¤ê¸ˆ**: ê³„ì¢Œ ë³€ê²½, ê¸ˆì•¡, ì§€ê¸‰ì‹œê¸°, ìˆ˜ë ¹ ì¡°ê±´
- **ğŸ“‹ ì¶œê²°ê´€ë¦¬**: QRì½”ë“œ, ì§€ê°, ì¡°í‡´, ì™¸ì¶œ, ê³µê²° ì‹ ì²­
- **ğŸ–¥ï¸ êµìœ¡ë„êµ¬**: ì¤Œ ì„¤ì •, ë…¸íŠ¸ë¶ ëŒ€ì—¬/ë°˜ë‚©, êµì¬ ìˆ˜ë ¹
- **ğŸ“ í•™ìŠµì§€ì›**: ê¸°ì´ˆí´ë˜ìŠ¤, OT, ë…¹í™”ë³¸, ê³¼ì œ ì œì¶œ
- **ğŸ’¼ ì»¤ë¦¬ì–´**: ìˆ˜ë£Œ í›„ ì·¨ì—…, ì¡°ê¸°ì·¨ì—…, ì¸í„´ì‹­, íŠ¹ê°•

### ğŸ”„ ê°œë°œ í™˜ê²½
- **ğŸ”—Base URL**: `http://localhost:8000`
- **ğŸ“–API ë¬¸ì„œ**: `/docs` (Swagger UI)
- **ğŸ”§ëŒ€ì•ˆ ë¬¸ì„œ**: `/redoc` (ReDoc)

### ğŸ’¡ ì‚¬ìš© í”Œë¡œìš°
1. `/chat` APIë¡œ ì§ˆë¬¸ ì „ì†¡
2. ì‹œìŠ¤í…œì´ í‚¤ì›Œë“œ ë§¤ì¹­ ì‹œë„
3. ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ AI ëª¨ë¸ í˜¸ì¶œ
4. ì‘ë‹µê³¼ í•¨ê»˜ ë§¤ì¹­ëœ í‚¤ì›Œë“œ ì •ë³´ ë°˜í™˜

### ğŸ”— API ì‚¬ìš© ì˜ˆì‹œ
```bash
# AI ì±—ë´‡ê³¼ ëŒ€í™”
POST /chat
{
  "prompt": "í›ˆë ¨ì¥ë ¤ê¸ˆì€ ì–¼ë§ˆì¸ê°€ìš”?",
  "use_ollama": true
}

# ì„œë²„ ìƒíƒœ í™•ì¸
GET /health

# QA ëª©ë¡ ì¡°íšŒ
GET /qa-list

# í‚¤ì›Œë“œë³„ QA ì¡°íšŒ
GET /qa-list?keyword=í›ˆë ¨ì¥ë ¤ê¸ˆ

# í‚¤ì›Œë“œ ê²€ìƒ‰ (ìƒì„¸ ë§¤ì¹­ ì •ë³´ í¬í•¨)
GET /qa-search?q=í›ˆë ¨ì¥ë ¤ê¸ˆ
```

### ğŸ“ ë¬¸ì˜
ë¼ì´ì–¸ í—¬í¼ ê°œë°œíŒ€

**License**: MIT
    """,
    contact={
        "name": "ë¼ì´ì–¸ í—¬í¼ ê°œë°œíŒ€",
        "url": "https://github.com/lionhelper/chatbot",
        "email": "dev@lionhelper.com"
    },
    license_info={
        "name": "MIT",
        "url": "https://opensource.org/licenses/MIT"
    },
    servers=[
        {
            "url": "https://lionhelper.onrender.com",
            "description": "ìš´ì˜ ì„œë²„ (Render.com)"
        },
        {
            "url": "http://localhost:8000",
            "description": "ë¡œì»¬ ê°œë°œ ì„œë²„"
        },
        {
            "url": "http://localhost:8001", 
            "description": "í…ŒìŠ¤íŠ¸ ì„œë²„"
        }
    ],
    tags_metadata=[
        {
            "name": "Chat",
            "description": "ğŸ¤– AI ì±—ë´‡ - í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬ ëŒ€í™”ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤"
        },
        {
            "name": "Health",
            "description": "ğŸ” ì„œë²„ ìƒíƒœ - ì„œë²„ ë° ëª¨ë¸ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤"
        },
        {
            "name": "Info",
            "description": "â„¹ï¸ ì‹œìŠ¤í…œ ì •ë³´ - ëª¨ë¸ ë° ê¸°ëŠ¥ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤"
        },
        {
            "name": "QA",
            "description": "â“ QA ê´€ë¦¬ - ë“±ë¡ëœ ì§ˆë¬¸ë‹µë³€ ëª©ë¡ì„ ê´€ë¦¬í•©ë‹ˆë‹¤"
        },
        {
            "name": "Sessions",
            "description": "ğŸ’¬ ëŒ€í™” ê¸°ë¡ - ì±„íŒ… ì„¸ì…˜ ë° ë©”ì‹œì§€ ê´€ë¦¬"
        }
    ]
)

# CORS ì„¤ì • (Swagger UIì™€ í”„ë¡ íŠ¸ì—”ë“œ í˜¸í™˜)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ëª¨ë“  ë„ë©”ì¸ í—ˆìš© (ê°œë°œìš©)
    allow_credentials=False,  # ê°œë°œ ì¤‘ì—ëŠ” falseë¡œ ì„¤ì •
    allow_methods=["*"],  # ëª¨ë“  ë©”ì„œë“œ í—ˆìš©
    allow_headers=["*"],  # ëª¨ë“  í—¤ë” í—ˆìš©
    expose_headers=["*"],
    max_age=86400
)

# ì¶”ê°€ CORS ë¯¸ë“¤ì›¨ì–´ (ê°•ì œ í—¤ë” ì¶”ê°€)
@app.middleware("http")
async def add_cors_headers(request: Request, call_next):
    """ëª¨ë“  ì‘ë‹µì— CORS í—¤ë” ê°•ì œ ì¶”ê°€"""
    response = await call_next(request)
    response.headers["Access-Control-Allow-Origin"] = "*"
    response.headers["Access-Control-Allow-Methods"] = "GET, POST, PUT, DELETE, OPTIONS, PATCH"
    response.headers["Access-Control-Allow-Headers"] = "*"
    response.headers["Access-Control-Expose-Headers"] = "*"
    return response

# ì „ì—­ ì˜ˆì™¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
@app.exception_handler(Exception)
async def global_exception_handler(request: Request, exc: Exception):
    """ëª¨ë“  ì˜ˆì™¸ì— ëŒ€í•´ JSON ì‘ë‹µì„ ë³´ì¥í•©ë‹ˆë‹¤."""
    logger.error(f"ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: {str(exc)}", exc_info=True)
    return JSONResponse(
        status_code=500,
        content={"detail": f"ë‚´ë¶€ ì„œë²„ ì˜¤ë¥˜: {str(exc)}"},
        headers={
            "Access-Control-Allow-Origin": "*",
            "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS, PATCH",
            "Access-Control-Allow-Headers": "*"
        }
    )

@app.exception_handler(RequestValidationError)
async def validation_exception_handler(request: Request, exc: RequestValidationError):
    """ìš”ì²­ ê²€ì¦ ì˜¤ë¥˜ì— ëŒ€í•œ JSON ì‘ë‹µì„ ë³´ì¥í•©ë‹ˆë‹¤."""
    logger.error(f"ìš”ì²­ ê²€ì¦ ì˜¤ë¥˜: {str(exc)}")
    return JSONResponse(
        status_code=422,
        content={"detail": "ìš”ì²­ ë°ì´í„°ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", "errors": exc.errors()},
        headers={
            "Access-Control-Allow-Origin": "*",
            "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS, PATCH",
            "Access-Control-Allow-Headers": "*"
        }
    )

@app.exception_handler(HTTPException)
async def http_exception_handler(request: Request, exc: HTTPException):
    """HTTP ì˜ˆì™¸ì— ëŒ€í•œ JSON ì‘ë‹µì„ ë³´ì¥í•©ë‹ˆë‹¤."""
    return JSONResponse(
        status_code=exc.status_code,
        content={"detail": exc.detail},
        headers={
            "Access-Control-Allow-Origin": "*",
            "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS, PATCH",
            "Access-Control-Allow-Headers": "*"
        }
    )

# ì •ì  íŒŒì¼ ì„œë¹™ ì„¤ì •
try:
    app.mount("/static", StaticFiles(directory="static"), name="static")
except:
    pass

print("í•˜ì´ë¸Œë¦¬ë“œ AI ì±—ë´‡ ì‹œìŠ¤í…œì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.")
print(f"Ollama ëª¨ë¸: {OLLAMA_MODEL}")

# CORS preflight ìš”ì²­ì„ ìœ„í•œ OPTIONS í•¸ë“¤ëŸ¬
@app.options("/{full_path:path}")
async def options_handler(request: Request, full_path: str):
    """ëª¨ë“  ê²½ë¡œì— ëŒ€í•œ OPTIONS ìš”ì²­ ì²˜ë¦¬"""
    return JSONResponse(
        content="OK",
        headers={
            "Access-Control-Allow-Origin": "*",
            "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS, PATCH",
            "Access-Control-Allow-Headers": "Accept, Accept-Language, Content-Language, Content-Type, Authorization, X-Requested-With, Origin",
            "Access-Control-Max-Age": "86400"
        }
    )

# Pydantic ëª¨ë¸
class ChatRequest(BaseModel):
    """AI ì±—ë´‡ ëŒ€í™” ìš”ì²­ ëª¨ë¸"""
    prompt: str = Field(..., description="ì‚¬ìš©ì ì§ˆë¬¸ ë˜ëŠ” ë©”ì‹œì§€", example="í›ˆë ¨ì¥ë ¤ê¸ˆì€ ì–¼ë§ˆì¸ê°€ìš”?")
    max_new_tokens: Optional[int] = Field(512, description="ìµœëŒ€ ìƒì„± í† í° ìˆ˜", example=512, ge=1, le=2048)
    temperature: Optional[float] = Field(0.6, description="ì°½ì˜ì„± ì¡°ì ˆ (0.0-2.0)", example=0.6, ge=0.0, le=2.0)
    top_p: Optional[float] = Field(0.9, description="í™•ë¥  ì„ê³„ê°’ (0.0-1.0)", example=0.9, ge=0.0, le=1.0)
    use_ollama: Optional[bool] = Field(True, description="Ollama AI ëª¨ë¸ ì‚¬ìš© ì—¬ë¶€", example=True)

    class Config:
        schema_extra = {
            "example": {
                "prompt": "í›ˆë ¨ì¥ë ¤ê¸ˆì€ ì–¸ì œ ë°›ì„ ìˆ˜ ìˆë‚˜ìš”?",
                "max_new_tokens": 512,
                "temperature": 0.6,
                "top_p": 0.9,
                "use_ollama": True
            }
        }

class ChatResponse(BaseModel):
    """AI ì±—ë´‡ ì‘ë‹µ ëª¨ë¸"""
    response: str = Field(..., description="AIì˜ ì‘ë‹µ ë©”ì‹œì§€", example="í›ˆë ¨ì¥ë ¤ê¸ˆì€ í•´ë‹¹ ê³¼ì •ì˜ ë‹¨ìœ„ê¸°ê°„ ë§ˆê°ì¼ì„ ê¸°ì¤€ìœ¼ë¡œ ì§€ê¸‰ê¹Œì§€ 2ì£¼ì—ì„œ 3ì£¼ ê°€ëŸ‰ ì†Œìš”ë©ë‹ˆë‹¤")
    model: str = Field(..., description="ì‚¬ìš©ëœ ëª¨ë¸ëª…", example="Keyword-based Fast Response System")
    status: str = Field(..., description="ì‘ë‹µ ìƒíƒœ", example="success")
    matched_keywords: Optional[List[str]] = Field(None, description="ë§¤ì¹­ëœ í‚¤ì›Œë“œ ëª©ë¡", example=["í›ˆë ¨ì¥ë ¤ê¸ˆ", "ì–¸ì œ", "ë°›ê¸°"])
    response_type: str = Field(..., description="ì‘ë‹µ ìœ í˜• (keyword/ollama/fallback)", example="keyword")

    class Config:
        schema_extra = {
            "example": {
                "response": "í›ˆë ¨ì¥ë ¤ê¸ˆì€ í•´ë‹¹ ê³¼ì •ì˜ ë‹¨ìœ„ê¸°ê°„ ë§ˆê°ì¼ì„ ê¸°ì¤€ìœ¼ë¡œ ì§€ê¸‰ê¹Œì§€ 2ì£¼ì—ì„œ 3ì£¼ ê°€ëŸ‰ ì†Œìš”ë©ë‹ˆë‹¤\n1ë‹¨ìœ„ê¸°ê°„ì˜ ê²½ìš°, í™•ì¸í•  ì‚¬í•­ì´ ë§ì•„ ì‹œê°„ì´ ë‹¤ì†Œ ì†Œìš”ë  ìˆ˜ ìˆë‹¤ëŠ” ì  ì°¸ê³  ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
                "model": "Keyword-based Fast Response System",
                "status": "success",
                "matched_keywords": ["í›ˆë ¨ì¥ë ¤ê¸ˆ", "ì–¸ì œ", "ë°›ê¸°", "ë‹¨ìœ„ê¸°ê°„", "2ì£¼"],
                "response_type": "keyword"
            }
        }

class SessionCreate(BaseModel):
    """ìƒˆ ì„¸ì…˜ ìƒì„± ìš”ì²­ ëª¨ë¸"""
    title: Optional[str] = Field("ìƒˆë¡œìš´ ëŒ€í™”", description="ì„¸ì…˜ ì œëª©", example="í›ˆë ¨ì¥ë ¤ê¸ˆ ë¬¸ì˜")

    class Config:
        schema_extra = {
            "example": {
                "title": "ì¶œê²° ë° í›ˆë ¨ì¥ë ¤ê¸ˆ ë¬¸ì˜"
            }
        }

class Session(BaseModel):
    """ì„¸ì…˜ ì •ë³´ ëª¨ë¸"""
    id: str = Field(..., description="ì„¸ì…˜ ê³ ìœ  ID", example="123e4567-e89b-12d3-a456-426614174000")
    title: str = Field(..., description="ì„¸ì…˜ ì œëª©", example="ì¶œê²° ë° í›ˆë ¨ì¥ë ¤ê¸ˆ ë¬¸ì˜")
    created_at: str = Field(..., description="ìƒì„± ì‹œê°„", example="2024-01-15 10:30:00")
    updated_at: str = Field(..., description="ìµœì¢… ì—…ë°ì´íŠ¸ ì‹œê°„", example="2024-01-15 11:45:00")

    class Config:
        schema_extra = {
            "example": {
                "id": "123e4567-e89b-12d3-a456-426614174000",
                "title": "ì¶œê²° ë° í›ˆë ¨ì¥ë ¤ê¸ˆ ë¬¸ì˜",
                "created_at": "2024-01-15 10:30:00",
                "updated_at": "2024-01-15 11:45:00"
            }
        }
    
class Message(BaseModel):
    """ë©”ì‹œì§€ ëª¨ë¸"""
    id: str = Field(..., description="ë©”ì‹œì§€ ê³ ìœ  ID", example="456e7890-e89b-12d3-a456-426614174001")
    session_id: str = Field(..., description="ì„¸ì…˜ ID", example="123e4567-e89b-12d3-a456-426614174000")
    role: str = Field(..., description="ë°œì‹ ì (user/assistant)", example="user")
    content: str = Field(..., description="ë©”ì‹œì§€ ë‚´ìš©", example="QRì½”ë“œ ì°ëŠ” ê±¸ ê¹œë¹¡í–ˆëŠ”ë° ì¶œê²°ì •ì • ê°€ëŠ¥í•œê°€ìš”?")
    response_type: Optional[str] = Field(None, description="ì‘ë‹µ ìœ í˜•", example="keyword")
    model_used: Optional[str] = Field(None, description="ì‚¬ìš©ëœ ëª¨ë¸ëª…", example="Keyword-based Fast Response System")
    created_at: str = Field(..., description="ìƒì„± ì‹œê°„", example="2024-01-15 10:30:00")

    class Config:
        schema_extra = {
            "example": {
                "id": "456e7890-e89b-12d3-a456-426614174001",
                "session_id": "123e4567-e89b-12d3-a456-426614174000",
                "role": "user",
                "content": "QRì½”ë“œ ì°ëŠ” ê±¸ ê¹œë¹¡í–ˆëŠ”ë° ì¶œê²°ì •ì • ê°€ëŠ¥í•œê°€ìš”?",
                "response_type": None,
                "model_used": None,
                "created_at": "2024-01-15 10:30:00"
            }
        }

def find_best_match(user_input: str) -> tuple:
    """ì‚¬ìš©ì ì…ë ¥ê³¼ ê°€ì¥ ì˜ ë§¤ì¹­ë˜ëŠ” QAë¥¼ ì°¾ìŠµë‹ˆë‹¤."""
    user_input_lower = user_input.lower()
    best_match = None
    best_score = 0
    matched_keywords = []
    
    for qa_id, qa_data in QA_DATABASE.items():
        score = 0
        keywords_found = []
        
        # í‚¤ì›Œë“œ ë§¤ì¹­ (ë” ê´€ëŒ€í•˜ê²Œ)
        for keyword in qa_data["keywords"]:
            if keyword.lower() in user_input_lower:
                score += 3  # í‚¤ì›Œë“œ ê°€ì¤‘ì¹˜ ì¦ê°€
                keywords_found.append(keyword)
        
        # ë¶€ë¶„ ë§¤ì¹­ë„ ê³ ë ¤
        for keyword in qa_data["keywords"]:
            if len(keyword) > 2:  # 2ê¸€ì ì´ìƒ í‚¤ì›Œë“œ
                for word in user_input_lower.split():
                    if keyword.lower() in word or word in keyword.lower():
                        score += 1
                        if keyword not in keywords_found:
                            keywords_found.append(keyword)
        
        # ì§ˆë¬¸ê³¼ì˜ ìœ ì‚¬ë„ ê³„ì‚° (ê°€ì¤‘ì¹˜ ê°ì†Œ)
        question_similarity = SequenceMatcher(None, user_input_lower, qa_data["question"].lower()).ratio()
        score += question_similarity * 2
        
        if score > best_score:
            best_score = score
            best_match = qa_data
            matched_keywords = keywords_found
    
    return best_match, best_score, matched_keywords

def create_session(title: str = "ìƒˆë¡œìš´ ëŒ€í™”") -> str:
    """ìƒˆë¡œìš´ ì±„íŒ… ì„¸ì…˜ ìƒì„±"""
    session_id = str(uuid.uuid4())
    conn = sqlite3.connect('chat_history.db')
    cursor = conn.cursor()
    
    cursor.execute('''
        INSERT INTO sessions (id, title) VALUES (?, ?)
    ''', (session_id, title))
    
    conn.commit()
    conn.close()
    return session_id

def save_message(session_id: str, role: str, content: str, response_type: str = None, model_used: str = None) -> str:
    """ë©”ì‹œì§€ ì €ì¥"""
    message_id = str(uuid.uuid4())
    conn = sqlite3.connect('chat_history.db')
    cursor = conn.cursor()
    
    cursor.execute('''
        INSERT INTO messages (id, session_id, role, content, response_type, model_used)
        VALUES (?, ?, ?, ?, ?, ?)
    ''', (message_id, session_id, role, content, response_type, model_used))
    
    # ì„¸ì…˜ ì—…ë°ì´íŠ¸ ì‹œê°„ ê°±ì‹ 
    cursor.execute('''
        UPDATE sessions SET updated_at = CURRENT_TIMESTAMP WHERE id = ?
    ''', (session_id,))
    
    conn.commit()
    conn.close()
    return message_id

def get_sessions() -> List[Session]:
    """ëª¨ë“  ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ"""
    conn = sqlite3.connect('chat_history.db')
    cursor = conn.cursor()
    
    cursor.execute('''
        SELECT id, title, created_at, updated_at 
        FROM sessions 
        ORDER BY updated_at DESC
    ''')
    
    sessions = []
    for row in cursor.fetchall():
        sessions.append(Session(
            id=row[0],
            title=row[1],
            created_at=row[2],
            updated_at=row[3]
        ))
    
    conn.close()
    return sessions

def get_session_messages(session_id: str) -> List[Message]:
    """íŠ¹ì • ì„¸ì…˜ì˜ ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ"""
    conn = sqlite3.connect('chat_history.db')
    cursor = conn.cursor()
    
    cursor.execute('''
        SELECT id, session_id, role, content, response_type, model_used, created_at
        FROM messages 
        WHERE session_id = ?
        ORDER BY created_at ASC
    ''', (session_id,))
    
    messages = []
    for row in cursor.fetchall():
        messages.append(Message(
            id=row[0],
            session_id=row[1],
            role=row[2],
            content=row[3],
            response_type=row[4],
            model_used=row[5],
            created_at=row[6]
        ))
    
    conn.close()
    return messages

def delete_session(session_id: str):
    """ì„¸ì…˜ê³¼ ê´€ë ¨ ë©”ì‹œì§€ ì‚­ì œ"""
    conn = sqlite3.connect('chat_history.db')
    cursor = conn.cursor()
    
    cursor.execute('DELETE FROM messages WHERE session_id = ?', (session_id,))
    cursor.execute('DELETE FROM sessions WHERE id = ?', (session_id,))
    
    conn.commit()
    conn.close()

def update_session_title(session_id: str, title: str):
    """ì„¸ì…˜ ì œëª© ì—…ë°ì´íŠ¸"""
    conn = sqlite3.connect('chat_history.db')
    cursor = conn.cursor()
    
    cursor.execute('''
        UPDATE sessions SET title = ?, updated_at = CURRENT_TIMESTAMP 
        WHERE id = ?
    ''', (title, session_id))
    
    conn.commit()
    conn.close()

async def call_ollama(prompt: str, max_tokens: int = 512, temperature: float = 0.6) -> str:
    """Ollama APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µì„ ë°›ìŠµë‹ˆë‹¤."""
    
    # ì…ë ¥ ê²€ì¦
    if not prompt or not prompt.strip():
        return "ì…ë ¥ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤."
    
    # ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ URLë§Œ ì‹œë„ (ë¹ ë¥¸ fallbackì„ ìœ„í•´)
    urls_to_try = []
    
    # ì™¸ë¶€ Ollama ì„œë¹„ìŠ¤ê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ìµœìš°ì„ 
    if EXTERNAL_OLLAMA_URL:
        urls_to_try.append(EXTERNAL_OLLAMA_URL)
    
    # ê¸°ë³¸ URL ì¶”ê°€
    urls_to_try.append(OLLAMA_BASE_URL)
    
    # ìµœëŒ€ 2ê°œ URLë§Œ ì‹œë„ (íƒ€ì„ì•„ì›ƒ ë°©ì§€)
    for url in urls_to_try[:2]:
        try:
            full_url = f"{url}/api/generate"
            logger.info(f"Ollama ì—°ê²° ì‹œë„: {full_url}")
            
            payload = {
                "model": OLLAMA_MODEL,
                "prompt": f"ë‹¤ìŒ ì§ˆë¬¸ì— ëŒ€í•´ í•œêµ­ì–´ë¡œ ì¹œì ˆí•˜ê³  ì •í™•í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”: {prompt}",
                "stream": False,
                "options": {
                    "num_predict": max_tokens,
                    "temperature": temperature
                }
            }
            
            response = requests.post(full_url, json=payload, timeout=5)
            response.raise_for_status()
            
            # JSON ì‘ë‹µ ì²˜ë¦¬
            try:
                result = response.json()
            except json.JSONDecodeError as e:
                logger.error(f"Ollama JSON íŒŒì‹± ì˜¤ë¥˜ ({url}): {str(e)}")
                continue
            
            # ì‘ë‹µ ê²€ì¦
            if not isinstance(result, dict):
                logger.error(f"Ollama ì‘ë‹µì´ ë”•ì…”ë„ˆë¦¬ê°€ ì•„ë‹˜ ({url}): {type(result)}")
                continue
                
            ollama_response = result.get("response", "").strip()
            if not ollama_response:
                logger.warning(f"Ollama ë¹ˆ ì‘ë‹µ ë°›ìŒ ({url})")
                continue
            
            logger.info(f"Ollama ì—°ê²° ì„±ê³µ: {url}")
            return ollama_response
            
        except requests.exceptions.Timeout:
            logger.warning(f"Ollama íƒ€ì„ì•„ì›ƒ ({url})")
            continue
        except requests.exceptions.ConnectionError:
            logger.warning(f"Ollama ì—°ê²° ì˜¤ë¥˜ ({url})")
            continue
        except requests.exceptions.RequestException as e:
            logger.warning(f"Ollama ìš”ì²­ ì‹¤íŒ¨ ({url}): {str(e)}")
            continue
        except Exception as e:
            logger.error(f"Ollama ì²˜ë¦¬ ì˜¤ë¥˜ ({url}): {str(e)}")
            continue
    
    # ëª¨ë“  ì—°ê²° ì‹œë„ ì‹¤íŒ¨
    logger.error("ëª¨ë“  Ollama ì—°ê²° ì‹œë„ ì‹¤íŒ¨")
    logger.error(f"ì‹œë„í•œ URLë“¤: {urls_to_try}")
    return "ì£„ì†¡í•©ë‹ˆë‹¤. AI ëª¨ë¸ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í‚¤ì›Œë“œ ê¸°ë°˜ ì‘ë‹µë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤."

@app.get(
    "/",
    summary="ğŸ  ë©”ì¸ í˜ì´ì§€",
    description="ë¼ì´ì–¸ í—¬í¼ AI ì±—ë´‡ì˜ ë©”ì¸ í˜ì´ì§€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤. ì •ì  íŒŒì¼ì´ ìˆìœ¼ë©´ HTMLì„, ì—†ìœ¼ë©´ API ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.",
    response_description="ë©”ì¸ í˜ì´ì§€ HTML ë˜ëŠ” API ìƒíƒœ ì •ë³´",
    tags=["Info"]
)
async def root():
    """
    ## ğŸ  ë£¨íŠ¸ ì—”ë“œí¬ì¸íŠ¸
    
    ë¼ì´ì–¸ í—¬í¼ AI ì±—ë´‡ ì„œë¹„ìŠ¤ì˜ ë©”ì¸ í˜ì´ì§€ì…ë‹ˆë‹¤.
    
    ### ğŸ“‹ ì‘ë‹µ ë°ì´í„°
    - **message**: ì„œë¹„ìŠ¤ ì„¤ëª…
    - **status**: ì„œë²„ ìƒíƒœ
    - **model**: ì‚¬ìš© ì¤‘ì¸ AI ëª¨ë¸
    - **language**: ì§€ì› ì–¸ì–´
    """
    try:
        return FileResponse("static/index.html")
    except:
        return {
            "message": "ë¼ì´ì–¸ í—¬í¼ AI ì±—ë´‡ API (í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œ)", 
            "status": "running",
            "model": f"Keyword-based + {OLLAMA_MODEL}",
            "language": "Korean",
            "features": [
                "í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ì‘ë‹µ",
                "AI ìƒì„± ì‘ë‹µ (Ollama)",
                "í›ˆë ¨ ê´€ë ¨ ì •ë³´ ì œê³µ",
                "ëŒ€í™” ê¸°ë¡ ê´€ë¦¬"
            ]
        }

@app.post(
    "/chat",
    response_model=ChatResponse,
    summary="ğŸ¤– AI ì±—ë´‡ ëŒ€í™”",
    description="í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬ AIì™€ ëŒ€í™”ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ì‘ë‹µê³¼ Ollama AI ëª¨ë¸ì„ í™œìš©í•©ë‹ˆë‹¤.",
    response_description="AI ì±—ë´‡ì˜ ì‘ë‹µê³¼ ë©”íƒ€ë°ì´í„°",
    tags=["Chat"]
)
async def chat_with_hybrid(request: ChatRequest):
    """
    ## ğŸ¤– AI ì±—ë´‡ê³¼ ëŒ€í™”
    
    í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìì™€ AI ê°„ì˜ ëŒ€í™”ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    
    ### ğŸ”„ ì²˜ë¦¬ ë°©ì‹
    1. **1ë‹¨ê³„**: í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ì‘ë‹µ ê²€ìƒ‰
    2. **2ë‹¨ê³„**: í‚¤ì›Œë“œ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ Ollama AI ëª¨ë¸ ì‚¬ìš©
    
    ### ğŸ“ ìš”ì²­ ë°ì´í„°
    - **prompt**: ì‚¬ìš©ì ì§ˆë¬¸ (í•„ìˆ˜)
    - **max_new_tokens**: ìµœëŒ€ í† í° ìˆ˜ (ê¸°ë³¸ê°’: 512)
    - **temperature**: ì°½ì˜ì„± ì¡°ì ˆ (ê¸°ë³¸ê°’: 0.6)
    - **use_ollama**: Ollama ì‚¬ìš© ì—¬ë¶€ (ê¸°ë³¸ê°’: true)
    
    ### ğŸ¯ ì‘ë‹µ ìœ í˜•
    - **keyword**: í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ì‘ë‹µ
    - **ollama**: AI ëª¨ë¸ ìƒì„± ì‘ë‹µ
    - **fallback**: ê¸°ë³¸ ì•ˆë‚´ ì‘ë‹µ
    
    ### ğŸ’¡ ì£¼ìš” ê¸°ëŠ¥
    - í›ˆë ¨ì¥ë ¤ê¸ˆ, ì¶œê²°, ê³µê²° ê´€ë ¨ ì¦‰ì‹œ ë‹µë³€
    - ì¤Œ, ìˆ˜ì—…, ë…¸íŠ¸ë¶ ê´€ë ¨ ì •ë³´ ì œê³µ
    - ì·¨ì—…, ì¸í„´ì‹­, ì»¤ë¦¬ì–´ ìƒë‹´ ì•ˆë‚´
    """
    
    try:
        # ì…ë ¥ ê²€ì¦
        if not request.prompt or not request.prompt.strip():
            raise HTTPException(status_code=400, detail="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
        
        # ê°„ë‹¨í•œ ë¡œê¹… (ì„ íƒì )
        logger.info(f"ì‚¬ìš©ì ì§ˆë¬¸: {request.prompt}")
        
        # 1ë‹¨ê³„: í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ì‘ë‹µ ì‹œë„
        best_match, score, matched_keywords = find_best_match(request.prompt)
        
        if best_match and score > 0.5:  # ì„ê³„ê°’ ë‚®ì¶¤ (ë” ë¹ ë¥¸ ì‘ë‹µ)
            response = best_match["answer"]
            status = "success"
            response_type = "keyword"
            model_name = "Keyword-based Fast Response System"
        else:
            # 2ë‹¨ê³„: í‚¤ì›Œë“œ ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ Ollama ì‚¬ìš©
            if request.use_ollama:
                ollama_response = await call_ollama(
                    request.prompt, 
                    request.max_new_tokens, 
                    request.temperature
                )
                
                # Ollama ì‘ë‹µì´ ì‹¤íŒ¨ ë©”ì‹œì§€ì¸ì§€ í™•ì¸
                if "ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤" in ollama_response or "ì£„ì†¡í•©ë‹ˆë‹¤" in ollama_response:
                    # ë” ë„ì›€ì´ ë˜ëŠ” ê¸°ë³¸ ì‘ë‹µ ì œê³µ
                    response = "ì•ˆë…•í•˜ì„¸ìš”! ë¼ì´ì–¸ í—¬í¼ì…ë‹ˆë‹¤. ğŸ˜Š\n\n"
                    response += "í˜„ì¬ ê³ ê¸‰ AI ê¸°ëŠ¥ì€ ì ê²€ ì¤‘ì´ì§€ë§Œ, ë¹ ë¥¸ í‚¤ì›Œë“œ ê²€ìƒ‰ìœ¼ë¡œ ë„ì›€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!\n\n"
                    response += "ğŸ“‹ **ìì£¼ ë¬¸ì˜í•˜ëŠ” ì£¼ì œë“¤:**\n"
                    response += "â€¢ ğŸ–¥ï¸ ì¤Œ/ë°°ê²½í™”ë©´ ì„¤ì •\nâ€¢ ğŸ’° í›ˆë ¨ì¥ë ¤ê¸ˆ/ê³„ì¢Œì •ë³´\nâ€¢ ğŸ“ ì¶œê²°/ì™¸ì¶œ/ê³µê²° ê´€ë ¨\nâ€¢ ğŸš» í™”ì¥ì‹¤/ìë¦¬ë¹„ì›€\nâ€¢ ğŸ“š ê¸°ì´ˆí´ë˜ìŠ¤/ì¶œê²°ë“±ë¡\nâ€¢ ğŸ’³ ë‚´ì¼ë°°ì›€ì¹´ë“œ/ë“±ë¡\nâ€¢ ğŸ¦· ì‚¬ë‘ë‹ˆ/ì¹˜ê³¼ì§„ë£Œ ê³µê²°\nâ€¢ ğŸ¥ ì…ì›/ì§„ë‹¨ì„œ ê´€ë ¨\n\n"
                    response += "êµ¬ì²´ì ì¸ í‚¤ì›Œë“œë¡œ ì§ˆë¬¸í•´ì£¼ì‹œë©´ ì •í™•í•œ ë‹µë³€ì„ ì¦‰ì‹œ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤! âœ¨"
                    status = "fallback"
                    response_type = "keyword"
                    model_name = "Keyword-based Fast Response System"
                    matched_keywords = []
                else:
                    response = ollama_response
                    status = "success"
                    response_type = "ollama"
                    model_name = OLLAMA_MODEL
                    matched_keywords = []
            else:
                response = "ì•ˆë…•í•˜ì„¸ìš”! ë¼ì´ì–¸ í—¬í¼ì…ë‹ˆë‹¤. ğŸ˜Š\n\n"
                response += "í˜„ì¬ ê³ ê¸‰ AI ê¸°ëŠ¥ì€ ì ê²€ ì¤‘ì´ì§€ë§Œ, ë¹ ë¥¸ í‚¤ì›Œë“œ ê²€ìƒ‰ìœ¼ë¡œ ë„ì›€ì„ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤!\n\n"
                response += "ğŸ“‹ **ìì£¼ ë¬¸ì˜í•˜ëŠ” ì£¼ì œë“¤:**\n"
                response += "â€¢ ğŸ–¥ï¸ ì¤Œ/ë°°ê²½í™”ë©´ ì„¤ì •\nâ€¢ ğŸ’° í›ˆë ¨ì¥ë ¤ê¸ˆ/ê³„ì¢Œì •ë³´\nâ€¢ ğŸ“ ì¶œê²°/ì™¸ì¶œ/ê³µê²° ê´€ë ¨\nâ€¢ ğŸš» í™”ì¥ì‹¤/ìë¦¬ë¹„ì›€\nâ€¢ ğŸ“š ê¸°ì´ˆí´ë˜ìŠ¤/ì¶œê²°ë“±ë¡\nâ€¢ ğŸ’³ ë‚´ì¼ë°°ì›€ì¹´ë“œ/ë“±ë¡\nâ€¢ ğŸ¦· ì‚¬ë‘ë‹ˆ/ì¹˜ê³¼ì§„ë£Œ ê³µê²°\nâ€¢ ğŸ¥ ì…ì›/ì§„ë‹¨ì„œ ê´€ë ¨\n\n"
                response += "êµ¬ì²´ì ì¸ í‚¤ì›Œë“œë¡œ ì§ˆë¬¸í•´ì£¼ì‹œë©´ ì •í™•í•œ ë‹µë³€ì„ ì¦‰ì‹œ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤! âœ¨"
                status = "no_match"
                response_type = "keyword"
                model_name = "Keyword-based Fast Response System"
                matched_keywords = []
        
        # ì‘ë‹µ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
        if not response:
            response = "ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
            status = "error"
        
        # ì‘ë‹µ ê°ì²´ ìƒì„±
        chat_response = ChatResponse(
            response=response,
            model=model_name,
            status=status,
            matched_keywords=matched_keywords if matched_keywords else [],
            response_type=response_type
        )
        
        # ë¡œê·¸ ì¶”ê°€ (ì§ˆë¬¸-ë‹µë³€ ìŒ ê¸°ë¡)
        logger.info(f"ì±—ë´‡ ì‘ë‹µ: response_type={response_type}, response_length={len(response)}")
        logger.info(f"ì‘ë‹µ ë‚´ìš©: {response[:100]}..." if len(response) > 100 else f"ì‘ë‹µ ë‚´ìš©: {response}")
        
        return chat_response
        
    except HTTPException:
        # HTTPExceptionì€ ê·¸ëŒ€ë¡œ ì „ë‹¬
        raise
    except Exception as e:
        logger.error(f"ì±„íŒ… ì˜¤ë¥˜: {str(e)}", exc_info=True)
        raise HTTPException(status_code=500, detail=f"ë‚´ë¶€ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")

@app.get(
    "/health",
    summary="ğŸ” ì„œë²„ ìƒíƒœ í™•ì¸",
    description="ì„œë²„ì™€ AI ëª¨ë¸ì˜ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œ í—¬ìŠ¤ì²´í¬ ë° ì—°ê²° ìƒíƒœë¥¼ ì ê²€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    response_description="ì„œë²„ ìƒíƒœ ë° ëª¨ë¸ ì—°ê²° ì •ë³´",
    tags=["Health"]
)
def health_check():
    """
    ## ğŸ” í—¬ìŠ¤ì²´í¬ API
    
    ì„œë²„ì™€ AI ëª¨ë¸ì˜ ì „ë°˜ì ì¸ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
    
    ### ğŸ“Š ì²´í¬ í•­ëª©
    - **ì„œë²„ ìƒíƒœ**: ê¸°ë³¸ ì„œë²„ ë™ì‘ í™•ì¸
    - **Ollama ì—°ê²°**: AI ëª¨ë¸ ì„œë²„ ì—°ê²° ìƒíƒœ
    - **QA ë°ì´í„°ë² ì´ìŠ¤**: í‚¤ì›Œë“œ ë°ì´í„° ê°œìˆ˜
    - **ì‘ë‹µ ëª¨ë“œ**: í˜„ì¬ ì„¤ì •ëœ ì‘ë‹µ ì‹œìŠ¤í…œ
    
    ### ğŸ¯ ì‘ë‹µ ìƒíƒœ
    - **healthy**: ì •ìƒ ë™ì‘
    - **connected**: Ollama ì—°ê²° ì„±ê³µ
    - **disconnected**: Ollama ì—°ê²° ì‹¤íŒ¨
    - **error**: Ollama ì˜¤ë¥˜ ë°œìƒ
    """
    # Ollama ì—°ê²° ìƒíƒœ í™•ì¸ (ë¹ ë¥¸ ì²´í¬)
    ollama_status = "unknown"
    try:
        # ë¹ ë¥¸ ì—°ê²° í…ŒìŠ¤íŠ¸ (2ì´ˆ íƒ€ì„ì•„ì›ƒ)
        response = requests.get(f"{OLLAMA_BASE_URL}/api/tags", timeout=2)
        if response.status_code == 200:
            ollama_status = "connected"
        else:
            ollama_status = "error"
    except:
        ollama_status = "disconnected"
    
    return {
        "status": "healthy",
        "model": f"Keyword-based + {OLLAMA_MODEL}",
        "device": "CPU",
        "language": "Korean",
        "qa_count": len(QA_DATABASE),
        "ollama_url": OLLAMA_BASE_URL,
        "ollama_status": ollama_status,
        "response_mode": "hybrid_optimized",
        "timeout_settings": "5s_connection_30s_graceful"
    }

@app.get(
    "/info",
    summary="â„¹ï¸ ì‹œìŠ¤í…œ ì •ë³´",
    description="AI ëª¨ë¸ê³¼ ì‹œìŠ¤í…œ ê¸°ëŠ¥ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.",
    response_description="ëª¨ë¸ ì •ë³´ ë° ì‹œìŠ¤í…œ ê¸°ëŠ¥ ëª©ë¡",
    tags=["Info"]
)
def get_info():
    """
    ## â„¹ï¸ ì‹œìŠ¤í…œ ì •ë³´ API
    
    ì‚¬ìš© ì¤‘ì¸ AI ëª¨ë¸ê³¼ ì‹œìŠ¤í…œì˜ ì£¼ìš” ê¸°ëŠ¥ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ### ğŸ“‹ ì œê³µ ì •ë³´
    - **ëª¨ë¸ëª…**: í•˜ì´ë¸Œë¦¬ë“œ AI ì‹œìŠ¤í…œ ì •ë³´
    - **ëª¨ë¸ íƒ€ì…**: ì‹œìŠ¤í…œ êµ¬ì„± ë°©ì‹
    - **ê¸°ëŠ¥ ëª©ë¡**: ì§€ì›í•˜ëŠ” ì£¼ìš” ê¸°ëŠ¥ë“¤
    - **QA ì£¼ì œ**: í‚¤ì›Œë“œ ê¸°ë°˜ ì‘ë‹µ ê°€ëŠ¥í•œ ì£¼ì œë“¤
    - **Ollama ëª¨ë¸**: ì‚¬ìš© ì¤‘ì¸ AI ëª¨ë¸ëª…
    """
    return {
        "model_name": f"Hybrid System: Keyword-based + {OLLAMA_MODEL}",
        "model_type": "Hybrid AI System",
        "description": "í‚¤ì›Œë“œ ê¸°ë°˜ ë¹ ë¥¸ ì‘ë‹µ + Ollama GPT-OSS-20B í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œ",
        "capabilities": [
            "í•œêµ­ì–´ ëŒ€í™”",
            "ë¹ ë¥¸ ì§ˆë¬¸ ë‹µë³€ (í‚¤ì›Œë“œ ê¸°ë°˜)",
            "AI ìƒì„± ì‘ë‹µ (Ollama)",
            "í‚¤ì›Œë“œ ë§¤ì¹­",
            "í›ˆë ¨ ê´€ë ¨ ì •ë³´ ì œê³µ"
        ],
        "qa_topics": list(QA_DATABASE.keys()),
        "ollama_model": OLLAMA_MODEL
    }

@app.get(
    "/qa-list",
    summary="â“ QA ëª©ë¡ ì¡°íšŒ",
    description="í‚¤ì›Œë“œ ê¸°ë°˜ ì‘ë‹µì´ ê°€ëŠ¥í•œ ë“±ë¡ëœ ì§ˆë¬¸ë‹µë³€ ëª©ë¡ì„ í™•ì¸í•©ë‹ˆë‹¤. í‚¤ì›Œë“œë¡œ í•„í„°ë§ ê°€ëŠ¥í•©ë‹ˆë‹¤.",
    response_description="QA ëª©ë¡ê³¼ í‚¤ì›Œë“œ ì •ë³´",
    tags=["QA"]
)
def get_qa_list(keyword: Optional[str] = None):
    """
    ## â“ QA ëª©ë¡ ì¡°íšŒ API
    
    ì‹œìŠ¤í…œì— ë“±ë¡ëœ ì§ˆë¬¸ë‹µë³€ ìŒê³¼ í‚¤ì›Œë“œ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ### ğŸ” ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜
    - **keyword**: íŠ¹ì • í‚¤ì›Œë“œë¡œ í•„í„°ë§ (ì„ íƒì‚¬í•­)
      - ì˜ˆ: `?keyword=í›ˆë ¨ì¥ë ¤ê¸ˆ` - í›ˆë ¨ì¥ë ¤ê¸ˆ ê´€ë ¨ QAë§Œ ì¡°íšŒ
      - ì˜ˆ: `?keyword=ì¶œê²°` - ì¶œê²° ê´€ë ¨ QAë§Œ ì¡°íšŒ
    
    ### ğŸ“‹ ì œê³µ ì •ë³´
    - **id**: QA í•­ëª© ê³ ìœ  ì‹ë³„ì
    - **question**: ì§ˆë¬¸ ë‚´ìš©
    - **answer**: ë‹µë³€ ë‚´ìš©
    - **keywords**: ë§¤ì¹­ë˜ëŠ” í‚¤ì›Œë“œ ëª©ë¡
    
    ### ğŸ” í™œìš© ë°©ë²•
    - ì „ì²´ QA ëª©ë¡ ì¡°íšŒ: `/qa-list`
    - í‚¤ì›Œë“œ í•„í„°ë§: `/qa-list?keyword=í›ˆë ¨ì¥ë ¤ê¸ˆ`
    - ë©”ì¸ í˜ì´ì§€ í‚¤ì›Œë“œ ë²„íŠ¼ ì—°ë™
    - API í…ŒìŠ¤íŠ¸ ë° ê°œë°œ ì°¸ê³ ìš©
    
    ### ğŸ“Š ì£¼ìš” í‚¤ì›Œë“œ ì¹´í…Œê³ ë¦¬
    - **í›ˆë ¨ì¥ë ¤ê¸ˆ**: ê³„ì¢Œ, ê¸ˆì•¡, ì§€ê¸‰ì‹œê¸°, ìˆ˜ë ¹
    - **ì¶œê²°**: QRì½”ë“œ, ì§€ê°, ê²°ì„, ê³µê²°
    - **ì¤Œ**: ë°°ê²½í™”ë©´, ì„¤ì •, ì ‘ì†, ì¹´ë©”ë¼
    - **ë…¸íŠ¸ë¶**: ëŒ€ì—¬, ë°˜ë‚©, ê³ ì¥, ìˆ˜ë¦¬
    """
    qa_list = []
    
    for qa_id, qa_data in QA_DATABASE.items():
        # í‚¤ì›Œë“œ í•„í„°ë§
        if keyword:
            # í‚¤ì›Œë“œê°€ QAì˜ í‚¤ì›Œë“œ ëª©ë¡ì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
            keyword_lower = keyword.lower()
            if not any(keyword_lower in kw.lower() for kw in qa_data["keywords"]):
                continue
        
        qa_list.append({
            "id": qa_id,
            "question": qa_data["question"],
            "answer": qa_data["answer"],
            "keywords": qa_data["keywords"]
        })
    
    return {
        "total_count": len(qa_list),
        "keyword_filter": keyword,
        "qa_list": qa_list
    }

@app.get(
    "/qa-keywords",
    summary="ğŸ·ï¸ QA í‚¤ì›Œë“œ ëª©ë¡",
    description="ë©”ì¸ í˜ì´ì§€ ë²„íŠ¼ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª¨ë“  í‚¤ì›Œë“œ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.",
    response_description="í‚¤ì›Œë“œ ëª©ë¡ê³¼ ê° í‚¤ì›Œë“œë³„ QA ê°œìˆ˜",
    tags=["QA"]
)
def get_qa_keywords(include_details: bool = False):
    """
    ## ğŸ·ï¸ QA í‚¤ì›Œë“œ ëª©ë¡ API
    
    ë©”ì¸ í˜ì´ì§€ì˜ í‚¤ì›Œë“œ ë²„íŠ¼ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª¨ë“  í‚¤ì›Œë“œì™€ ê° í‚¤ì›Œë“œë³„ QA ê°œìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
    
    ### ğŸ” ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜
    - **include_details**: ìƒì„¸ QA ì •ë³´ í¬í•¨ ì—¬ë¶€ (ê¸°ë³¸ê°’: false)
      - false: í‚¤ì›Œë“œì™€ ê°œìˆ˜ë§Œ ë°˜í™˜ (ë©”ì¸ í˜ì´ì§€ìš©)
      - true: ëª¨ë“  QA ì •ë³´ë„ í¬í•¨ (ìƒì„¸ í˜ì´ì§€ìš©)
    
    ### ğŸ“‹ ì œê³µ ì •ë³´
    - **keyword**: í‚¤ì›Œë“œëª…
    - **count**: í•´ë‹¹ í‚¤ì›Œë“œê°€ í¬í•¨ëœ QA ê°œìˆ˜
    - **qa_list**: í•´ë‹¹ í‚¤ì›Œë“œì˜ ëª¨ë“  QA (include_details=trueì¼ ë•Œë§Œ)
    
    ### ğŸ’¡ í™œìš© ë°©ë²•
    - ë©”ì¸ í˜ì´ì§€ í‚¤ì›Œë“œ ë²„íŠ¼: `/qa-keywords`
    - í‚¤ì›Œë“œë³„ ìƒì„¸ ì •ë³´: `/qa-keywords?include_details=true`
    - ì¸ê¸° í‚¤ì›Œë“œ ìˆœì„œë¡œ ì •ë ¬
    """
    keyword_stats = {}
    
    # ëª¨ë“  QAë¥¼ ìˆœíšŒí•˜ë©° í‚¤ì›Œë“œ í†µê³„ ìˆ˜ì§‘
    for qa_id, qa_data in QA_DATABASE.items():
        for keyword in qa_data["keywords"]:
            if keyword not in keyword_stats:
                keyword_stats[keyword] = {
                    "count": 0,
                    "qa_list": [],
                    "qa_ids": set()  # ì¤‘ë³µ ë°©ì§€ìš©
                }
            
            # ê°™ì€ QAê°€ ì•„ì§ ì¶”ê°€ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì¶”ê°€
            if qa_id not in keyword_stats[keyword]["qa_ids"]:
                keyword_stats[keyword]["count"] += 1
                keyword_stats[keyword]["qa_ids"].add(qa_id)
                keyword_stats[keyword]["qa_list"].append({
                    "id": qa_id,
                    "question": qa_data["question"],
                    "answer": qa_data["answer"],
                    "keywords": qa_data["keywords"]
                })
    
    # ê°œìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ë°˜í™˜
    sorted_keywords = sorted(
        keyword_stats.items(), 
        key=lambda x: x[1]["count"], 
        reverse=True
    )
    
    result = {
        "total_keywords": len(keyword_stats),
        "keywords": []
    }
    
    for keyword, stats in sorted_keywords:
        keyword_data = {
            "keyword": keyword,
            "count": stats["count"]
        }
        
        # include_detailsê°€ Trueì¼ ë•Œë§Œ QA ëª©ë¡ í¬í•¨
        if include_details:
            keyword_data["qa_list"] = stats["qa_list"]
        else:
            # ê°„ë‹¨í•œ ë¯¸ë¦¬ë³´ê¸°ìš©ìœ¼ë¡œ ì²« ë²ˆì§¸ ì§ˆë¬¸ë§Œ í¬í•¨
            keyword_data["sample_question"] = stats["qa_list"][0]["question"] if stats["qa_list"] else ""
        
        result["keywords"].append(keyword_data)
    
    return result

@app.get(
    "/qa-search",
    summary="ğŸ” QA ê²€ìƒ‰",
    description="í‚¤ì›Œë“œë¡œ QAë¥¼ ê²€ìƒ‰í•˜ê³  ë§¤ì¹­ ê²°ê³¼ë¥¼ ìƒì„¸íˆ í‘œì‹œí•©ë‹ˆë‹¤.",
    response_description="ê²€ìƒ‰ ê²°ê³¼ì™€ ë§¤ì¹­ ì •ë³´",
    tags=["QA"]
)
def search_qa(q: str):
    """
    ## ğŸ” QA ê²€ìƒ‰ API
    
    í‚¤ì›Œë“œë¡œ QAë¥¼ ê²€ìƒ‰í•˜ê³  ì–´ë–¤ í‚¤ì›Œë“œê°€ ë§¤ì¹­ë˜ì—ˆëŠ”ì§€ ìƒì„¸íˆ ë³´ì—¬ì¤ë‹ˆë‹¤.
    
    ### ğŸ” ì¿¼ë¦¬ ë§¤ê°œë³€ìˆ˜
    - **q**: ê²€ìƒ‰í•  í‚¤ì›Œë“œ (í•„ìˆ˜)
      - ì˜ˆ: `?q=í›ˆë ¨ì¥ë ¤ê¸ˆ` - í›ˆë ¨ì¥ë ¤ê¸ˆ ê´€ë ¨ QA ê²€ìƒ‰
      - ì˜ˆ: `?q=ì¶œê²°` - ì¶œê²° ê´€ë ¨ QA ê²€ìƒ‰
    
    ### ğŸ“‹ ì œê³µ ì •ë³´
    - **search_keyword**: ê²€ìƒ‰í•œ í‚¤ì›Œë“œ
    - **matched_keywords**: ì‹¤ì œ ë§¤ì¹­ëœ í‚¤ì›Œë“œë“¤
    - **total_count**: ë§¤ì¹­ëœ QA ê°œìˆ˜
    - **qa_results**: ê²€ìƒ‰ ê²°ê³¼ (ë§¤ì¹­ í‚¤ì›Œë“œ í•˜ì´ë¼ì´íŠ¸ í¬í•¨)
    
    ### ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ
    ```
    GET /qa-search?q=í›ˆë ¨ì¥ë ¤ê¸ˆ
    ```
    """
    if not q or not q.strip():
        raise HTTPException(status_code=400, detail="ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    
    search_keyword = q.strip().lower()
    qa_results = []
    matched_keywords_set = set()
    
    for qa_id, qa_data in QA_DATABASE.items():
        # ë§¤ì¹­ëœ í‚¤ì›Œë“œë“¤ ì°¾ê¸°
        matched_keywords = []
        for keyword in qa_data["keywords"]:
            if search_keyword in keyword.lower():
                matched_keywords.append(keyword)
                matched_keywords_set.add(keyword)
        
        # ë§¤ì¹­ëœ í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ ê²°ê³¼ì— ì¶”ê°€
        if matched_keywords:
            qa_results.append({
                "id": qa_id,
                "question": qa_data["question"],
                "answer": qa_data["answer"],
                "all_keywords": qa_data["keywords"],
                "matched_keywords": matched_keywords,
                "match_score": len(matched_keywords)  # ë§¤ì¹­ëœ í‚¤ì›Œë“œ ê°œìˆ˜
            })
    
    # ë§¤ì¹­ ì ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬ (ë§¤ì¹­ëœ í‚¤ì›Œë“œê°€ ë§ì€ ìˆœ)
    qa_results.sort(key=lambda x: x["match_score"], reverse=True)
    
    return {
        "search_keyword": q,
        "matched_keywords": list(matched_keywords_set),
        "total_count": len(qa_results),
        "qa_results": qa_results
    }

# === ëŒ€í™” ê¸°ë¡ ê´€ë¦¬ API ===

@app.post(
    "/sessions",
    response_model=Session,
    summary="ğŸ’¬ ìƒˆ ëŒ€í™” ì„¸ì…˜ ìƒì„±",
    description="ìƒˆë¡œìš´ ì±„íŒ… ì„¸ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤. ëŒ€í™” ê¸°ë¡ì„ êµ¬ë¶„í•˜ì—¬ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    response_description="ìƒì„±ëœ ì„¸ì…˜ ì •ë³´",
    tags=["Sessions"]
)
def create_new_session(session_data: SessionCreate):
    """
    ## ğŸ’¬ ìƒˆ ëŒ€í™” ì„¸ì…˜ ìƒì„±
    
    ìƒˆë¡œìš´ ì±„íŒ… ì„¸ì…˜ì„ ìƒì„±í•˜ì—¬ ëŒ€í™”ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    ### ğŸ“ ìš”ì²­ ë°ì´í„°
    - **title**: ì„¸ì…˜ ì œëª© (ì„ íƒ, ê¸°ë³¸ê°’: "ìƒˆë¡œìš´ ëŒ€í™”")
    
    ### ğŸ“‹ ì‘ë‹µ ë°ì´í„°
    - **id**: ì„¸ì…˜ ê³ ìœ  ID
    - **title**: ì„¸ì…˜ ì œëª©
    - **created_at**: ìƒì„± ì‹œê°„
    - **updated_at**: ìµœì¢… ì—…ë°ì´íŠ¸ ì‹œê°„
    
    ### ğŸ’¡ í™œìš© ë°©ë²•
    - ì£¼ì œë³„ë¡œ ëŒ€í™”ë¥¼ êµ¬ë¶„í•˜ì—¬ ê´€ë¦¬
    - ì„¸ì…˜ IDë¥¼ ì±—ë´‡ APIì— ì „ë‹¬í•˜ì—¬ ì—°ì† ëŒ€í™”
    - ëŒ€í™” ê¸°ë¡ ì¶”ì  ë° ê´€ë¦¬
    """
    session_id = create_session(session_data.title)
    sessions = get_sessions()
    for session in sessions:
        if session.id == session_id:
            return session
    raise HTTPException(status_code=500, detail="ì„¸ì…˜ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")

@app.get(
    "/sessions",
    response_model=List[Session],
    summary="ğŸ“‹ ëŒ€í™” ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ",
    description="ëª¨ë“  ì±„íŒ… ì„¸ì…˜ì˜ ëª©ë¡ì„ ìµœì‹ ìˆœìœ¼ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.",
    response_description="ì„¸ì…˜ ëª©ë¡ (ìµœì‹ ìˆœ ì •ë ¬)",
    tags=["Sessions"]
)
def list_sessions():
    """
    ## ğŸ“‹ ëŒ€í™” ì„¸ì…˜ ëª©ë¡ ì¡°íšŒ
    
    ìƒì„±ëœ ëª¨ë“  ì±„íŒ… ì„¸ì…˜ì„ ìµœì‹  ì—…ë°ì´íŠ¸ ìˆœìœ¼ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.
    
    ### ğŸ“‹ ì‘ë‹µ ë°ì´í„°
    - **Array of Session**: ì„¸ì…˜ ëª©ë¡
      - **id**: ì„¸ì…˜ ê³ ìœ  ID
      - **title**: ì„¸ì…˜ ì œëª©
      - **created_at**: ìƒì„± ì‹œê°„
      - **updated_at**: ìµœì¢… ì—…ë°ì´íŠ¸ ì‹œê°„
    
    ### ğŸ”„ ì •ë ¬ ê¸°ì¤€
    - ìµœê·¼ ì—…ë°ì´íŠ¸ëœ ì„¸ì…˜ì´ ë¨¼ì € í‘œì‹œ
    - í™œë°œí•œ ëŒ€í™” ì„¸ì…˜ì„ ìš°ì„ ì ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥
    """
    return get_sessions()

@app.get(
    "/sessions/{session_id}/messages",
    response_model=List[Message],
    summary="ğŸ’¬ ì„¸ì…˜ ë©”ì‹œì§€ ì¡°íšŒ",
    description="íŠ¹ì • ì„¸ì…˜ì˜ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì‹œê°„ìˆœìœ¼ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.",
    response_description="ë©”ì‹œì§€ ëª©ë¡ (ì‹œê°„ìˆœ ì •ë ¬)",
    tags=["Sessions"]
)
def get_messages(session_id: str):
    """
    ## ğŸ’¬ ì„¸ì…˜ ë©”ì‹œì§€ ì¡°íšŒ
    
    íŠ¹ì • ì„¸ì…˜ì˜ ëª¨ë“  ëŒ€í™” ë©”ì‹œì§€ë¥¼ ì‹œê°„ ìˆœì„œëŒ€ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.
    
    ### ğŸ”— ê²½ë¡œ ë§¤ê°œë³€ìˆ˜
    - **session_id**: ì„¸ì…˜ ê³ ìœ  ID
    
    ### ğŸ“‹ ì‘ë‹µ ë°ì´í„°
    - **Array of Message**: ë©”ì‹œì§€ ëª©ë¡
      - **id**: ë©”ì‹œì§€ ê³ ìœ  ID
      - **session_id**: ì„¸ì…˜ ID
      - **role**: ë°œì‹ ì (user/assistant)
      - **content**: ë©”ì‹œì§€ ë‚´ìš©
      - **response_type**: ì‘ë‹µ ìœ í˜• (keyword/ollama)
      - **model_used**: ì‚¬ìš©ëœ ëª¨ë¸ëª…
      - **created_at**: ìƒì„± ì‹œê°„
    
    ### ğŸ”„ ì •ë ¬ ê¸°ì¤€
    - ì‹œê°„ìˆœ ì •ë ¬ (ì˜¤ë˜ëœ ë©”ì‹œì§€ë¶€í„°)
    - ëŒ€í™” íë¦„ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì¶”ì  ê°€ëŠ¥
    """
    messages = get_session_messages(session_id)
    if not messages:
        # ë¹ˆ ì„¸ì…˜ì´ê±°ë‚˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì„¸ì…˜ì¸ì§€ í™•ì¸
        sessions = get_sessions()
        session_exists = any(s.id == session_id for s in sessions)
        if not session_exists:
            raise HTTPException(status_code=404, detail="ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    return messages

@app.delete(
    "/sessions/{session_id}",
    summary="ğŸ—‘ï¸ ì„¸ì…˜ ì‚­ì œ",
    description="ì§€ì •ëœ ì„¸ì…˜ê³¼ ê´€ë ¨ëœ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.",
    response_description="ì‚­ì œ ì™„ë£Œ ë©”ì‹œì§€",
    tags=["Sessions"]
)
def remove_session(session_id: str):
    """
    ## ğŸ—‘ï¸ ì„¸ì…˜ ì‚­ì œ
    
    ì§€ì •ëœ ì„¸ì…˜ê³¼ í•´ë‹¹ ì„¸ì…˜ì˜ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤.
    
    ### ğŸ”— ê²½ë¡œ ë§¤ê°œë³€ìˆ˜
    - **session_id**: ì‚­ì œí•  ì„¸ì…˜ ID
    
    ### âš ï¸ ì£¼ì˜ì‚¬í•­
    - ì‚­ì œëœ ì„¸ì…˜ê³¼ ë©”ì‹œì§€ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
    - ì‚­ì œ ì „ì— ì¤‘ìš”í•œ ëŒ€í™” ë‚´ìš©ì„ ë°±ì—…í•˜ì„¸ìš”
    
    ### ğŸ“‹ ì‘ë‹µ ë°ì´í„°
    - **message**: ì‚­ì œ ì™„ë£Œ ë©”ì‹œì§€
    - **session_id**: ì‚­ì œëœ ì„¸ì…˜ ID
    """
    try:
        delete_session(session_id)
        return {"message": "ì„¸ì…˜ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.", "session_id": session_id}
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ì„¸ì…˜ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")

@app.put(
    "/sessions/{session_id}/title",
    summary="âœï¸ ì„¸ì…˜ ì œëª© ë³€ê²½",
    description="ì§€ì •ëœ ì„¸ì…˜ì˜ ì œëª©ì„ ë³€ê²½í•©ë‹ˆë‹¤.",
    response_description="ì œëª© ë³€ê²½ ì™„ë£Œ ë©”ì‹œì§€",
    tags=["Sessions"]
)
def rename_session(session_id: str, title_data: dict):
    """
    ## âœï¸ ì„¸ì…˜ ì œëª© ë³€ê²½
    
    ì§€ì •ëœ ì„¸ì…˜ì˜ ì œëª©ì„ ìƒˆë¡œìš´ ì œëª©ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
    
    ### ğŸ”— ê²½ë¡œ ë§¤ê°œë³€ìˆ˜
    - **session_id**: ì œëª©ì„ ë³€ê²½í•  ì„¸ì…˜ ID
    
    ### ğŸ“ ìš”ì²­ ë°ì´í„°
    - **title**: ìƒˆë¡œìš´ ì„¸ì…˜ ì œëª© (í•„ìˆ˜)
    
    ### ğŸ“‹ ì‘ë‹µ ë°ì´í„°
    - **message**: ë³€ê²½ ì™„ë£Œ ë©”ì‹œì§€
    - **session_id**: ì„¸ì…˜ ID
    - **title**: ë³€ê²½ëœ ì œëª©
    
    ### ğŸ’¡ í™œìš© ì˜ˆì‹œ
    ```json
    {
      "title": "í›ˆë ¨ì¥ë ¤ê¸ˆ ë° ì¶œê²° ë¬¸ì˜"
    }
    ```
    """
    title = title_data.get("title")
    if not title:
        raise HTTPException(status_code=400, detail="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    
    try:
        update_session_title(session_id, title)
        return {"message": "ì„¸ì…˜ ì œëª©ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.", "session_id": session_id, "title": title}
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ì œëª© ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")

@app.get(
    "/sessions/{session_id}",
    response_model=Session,
    summary="ğŸ” ì„¸ì…˜ ì •ë³´ ì¡°íšŒ",
    description="ì§€ì •ëœ ì„¸ì…˜ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.",
    response_description="ì„¸ì…˜ ìƒì„¸ ì •ë³´",
    tags=["Sessions"]
)
def get_session_info(session_id: str):
    """
    ## ğŸ” ì„¸ì…˜ ì •ë³´ ì¡°íšŒ
    
    ì§€ì •ëœ ì„¸ì…˜ì˜ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
    
    ### ğŸ”— ê²½ë¡œ ë§¤ê°œë³€ìˆ˜
    - **session_id**: ì¡°íšŒí•  ì„¸ì…˜ ID
    
    ### ğŸ“‹ ì‘ë‹µ ë°ì´í„°
    - **id**: ì„¸ì…˜ ê³ ìœ  ID
    - **title**: ì„¸ì…˜ ì œëª©
    - **created_at**: ìƒì„± ì‹œê°„
    - **updated_at**: ìµœì¢… ì—…ë°ì´íŠ¸ ì‹œê°„
    
    ### ğŸš« ì˜¤ë¥˜ ì‘ë‹µ
    - **404**: ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
    """
    sessions = get_sessions()
    for session in sessions:
        if session.id == session_id:
            return session
    raise HTTPException(status_code=404, detail="ì„¸ì…˜ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

if __name__ == "__main__":
    port = int(os.getenv("PORT", 8001))  # ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©
    uvicorn.run(app, host="0.0.0.0", port=port)